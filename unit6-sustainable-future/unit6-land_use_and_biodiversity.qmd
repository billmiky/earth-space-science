---
title: "Unit 6: Land Use and Biodiversity"
subtitle: "How do the ways we change land affect the health of people and ecosystems?"
author: "Earth & Space Science"
format:
  html:
    toc: true
    toc-depth: 3
    number-sections: true
    theme: cosmo
    code-fold: true
    self-contained: true
execute:
  echo: true
  warning: false
---

```{=html}
<style>
@import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@700&family=Inter:wght@400;600;800&display=swap');

.engage-box {
  background: linear-gradient(135deg, #00b894 0%, #1e6f5c 100%);
  color: white;
  padding: 25px;
  margin: 20px 0;
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(0, 184, 148, 0.3);
  border: none;
}
.engage-box h2 { font-family: 'Space Grotesk', sans-serif; font-size: 2em; margin-top: 0; }

.explore-box {
  background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  color: white;
  padding: 25px;
  margin: 20px 0;
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(240, 147, 251, 0.3);
}

.explain-box {
  background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
  color: #1a1a1a;
  padding: 25px;
  margin: 20px 0;
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(79, 172, 254, 0.3);
}

.elaborate-box {
  background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
  color: #1a1a1a;
  padding: 25px;
  margin: 20px 0;
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(67, 233, 123, 0.3);
}

.evaluate-box {
  background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
  color: #1a1a1a;
  padding: 25px;
  margin: 20px 0;
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(250, 112, 154, 0.3);
}

.check-understanding {
  background: linear-gradient(to right, #00b894, #1e6f5c);
  color: white;
  padding: 20px;
  margin: 20px 0;
  border-radius: 12px;
  border-left: 6px solid #fff;
}

.key-idea {
  background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
  padding: 20px;
  margin: 20px 0;
  border-radius: 12px;
  border-left: 8px solid #ff6b6b;
  font-size: 1.1em;
}

.student-task {
  background: #fff3e0;
  border-left: 5px solid #ff9800;
  padding: 20px;
  margin: 15px 0;
  border-radius: 0 10px 10px 0;
}

.pe-badge {
  display: inline-block;
  background: linear-gradient(135deg, #00b894 0%, #1e6f5c 100%);
  color: white;
  padding: 8px 16px;
  border-radius: 20px;
  font-size: 13px;
  font-weight: 800;
  margin: 5px;
  box-shadow: 0 4px 15px rgba(0, 184, 148, 0.4);
  text-transform: uppercase;
  letter-spacing: 1px;
}

.big-question {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 2.5em;
  font-weight: 800;
  background: linear-gradient(135deg, #00b894 0%, #1e6f5c 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  margin: 30px 0 20px 0;
  text-align: center;
  animation: slideIn 0.8s ease-out;
}

.mind-blown {
  background: linear-gradient(135deg, #00b894 0%, #1e6f5c 100%);
  color: white;
  padding: 20px;
  margin: 20px 0;
  border-radius: 15px;
  font-size: 1.3em;
  font-weight: 700;
  text-align: center;
  box-shadow: 0 10px 25px rgba(0, 184, 148, 0.4);
}

@keyframes slideIn {
  from { opacity: 0; transform: translateY(-20px); }
  to { opacity: 1; transform: translateY(0); }
}

h1 {
  font-family: 'Space Grotesk', sans-serif !important;
  font-weight: 800 !important;
  font-size: 2.8em !important;
  margin-top: 40px !important;
}

h2 {
  font-family: 'Space Grotesk', sans-serif !important;
  font-weight: 700 !important;
  color: #00b894 !important;
}
</style>
```

<span class="pe-badge">HS-ESS3-3</span> <span class="pe-badge">HS-ETS1-4</span> <span class="pe-badge">Time: 6‚Äì8 Days</span>

<div class="big-question">üå≥ Land Use & Biodiversity: The Heat Is On üå≥</div>

# Engage: The Investigative Phenomenon

::: {.engage-box}
## üå°Ô∏è 350 New Yorkers Die Every Year From Heat ‚Äî and It's Not Random

<div style="font-size: 1.3em; font-weight: 700; text-align: center; margin: 20px 0; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">
350 New Yorkers die every year from the urban heat island effect. But the risk depends heavily on which neighborhood you live in.
</div>

**The Numbers:**

- üå°Ô∏è NYC is **7¬∞F (4¬∞C) hotter** than surrounding rural areas in summer
- üè• **~2,000** heat-related ER visits per year
- ‚òÄÔ∏è Currently **17 days** above 90¬∞F per year ‚Äî projected to be **39** by 2050
- üí∞ Over **$100 million** in annual healthcare costs from heat

### ü§î Driving Questions
- Why are cities so much hotter than surrounding areas?
- Why does heat kill more people in some neighborhoods than others?
- What can we do to cool cities down and save lives?
:::

```{ojs}
//| echo: false
Plot = require("@observablehq/plot")
d3 = require("d3@7")
```

```{ojs}
//| echo: false
neighborhoodData = [
  {name: "East Harlem", hvi: 5, income: 36000, greenSpace: 8, deaths: 18},
  {name: "South Bronx", hvi: 5, income: 28000, greenSpace: 6, deaths: 21},
  {name: "Brownsville", hvi: 5, income: 31000, greenSpace: 5, deaths: 19},
  {name: "Upper East Side", hvi: 1, income: 138000, greenSpace: 22, deaths: 3},
  {name: "Brooklyn Heights", hvi: 2, income: 125000, greenSpace: 18, deaths: 5},
  {name: "Park Slope", hvi: 1, income: 145000, greenSpace: 25, deaths: 2}
]

Plot.plot({
  title: "NYC Heat Vulnerability: Income vs. Heat Deaths by Neighborhood",
  subtitle: "Color = Heat Vulnerability Index (1=low, 5=high). Size = % Green Space",
  width: 750,
  height: 450,
  x: {label: "Median Household Income ($)", domain: [20000, 160000]},
  y: {label: "Heat-Related Deaths per 100,000", domain: [0, 25]},
  r: {domain: [3, 30], range: [6, 35]},
  color: {
    domain: [1, 2, 3, 4, 5],
    scheme: "YlOrRd",
    legend: true,
    label: "Heat Vulnerability Index"
  },
  marks: [
    Plot.dot(neighborhoodData, {
      x: "income",
      y: "deaths",
      r: "greenSpace",
      fill: "hvi",
      stroke: "#2d3436",
      strokeWidth: 1.5
    }),
    Plot.text(neighborhoodData, {
      x: "income",
      y: "deaths",
      text: "name",
      dy: -20,
      fontSize: 11,
      fontWeight: "bold"
    })
  ]
})
```

<div class="mind-blown">
ü§Ø Low-income neighborhoods with less green space have up to 10√ó more heat-related deaths than wealthy neighborhoods just a few miles away. The heat isn't equal ‚Äî and neither are the consequences.
</div>

::: {.student-task}
### üìù Analyze the Pattern

1. What's the relationship between **income** and heat-related deaths?
2. What's the relationship between **green space** (bubble size) and heat deaths?
3. Why do you think the South Bronx (6% green space, $28K income) has so many more heat deaths than Park Slope (25% green space, $145K income)?
4. Is this a **coincidence** or a **pattern**? What additional data would you want to see?
:::

# Explore: How Did NYC Get So Hot?

::: {.explore-box}
## üî¨ 400 Years of Land Use Change: From Forests to Concrete

Manhattan was once covered in forests, wetlands, and streams. Over 400 years, nearly all of it was replaced with buildings, asphalt, and concrete. That transformation created the heat island effect you see today.
:::

## Manhattan's Transformation

```{ojs}
//| echo: false
landCover = [
  {year: "1609\n(Pre-colonial)", forest: 70, wetland: 15, water: 10, agriculture: 0, urban: 0},
  {year: "1800", forest: 30, wetland: 10, water: 8, agriculture: 35, urban: 15},
  {year: "1900", forest: 5, wetland: 3, water: 6, agriculture: 5, urban: 80},
  {year: "2020", forest: 3, wetland: 0.5, water: 5, agriculture: 0, urban: 91}
]

landLong = landCover.flatMap(d => [
  {year: d.year, type: "Forest", pct: d.forest},
  {year: d.year, type: "Wetland", pct: d.wetland},
  {year: d.year, type: "Urban/Built", pct: d.urban},
  {year: d.year, type: "Agriculture", pct: d.agriculture},
  {year: d.year, type: "Water", pct: d.water}
])

Plot.plot({
  title: "Manhattan Land Cover Change (1609‚Äì2020)",
  subtitle: "From 70% forest to 91% concrete and buildings",
  width: 750,
  height: 420,
  x: {label: null},
  y: {label: "% of Land Area", domain: [0, 100]},
  color: {
    domain: ["Forest", "Wetland", "Water", "Agriculture", "Urban/Built"],
    range: ["#00b894", "#74b9ff", "#0984e3", "#fdcb6e", "#636e72"],
    legend: true
  },
  marks: [
    Plot.barY(landLong, Plot.stackY({
      x: "year",
      y: "pct",
      fill: "type",
      order: "appearance"
    })),
    Plot.ruleY([0])
  ]
})
```

## Why Does This Make Cities Hotter?

Different surfaces absorb and reflect very different amounts of sunlight. Use the slider to see how surface type affects temperature:

```{ojs}
//| echo: false
viewof surfaceMix = Inputs.range([0, 100], {label: "% of area covered by vegetation (vs. asphalt/buildings)", step: 5, value: 10})
```

```{ojs}
//| echo: false
{
  const asphaltPct = 100 - surfaceMix;
  // Surface temperature model
  const avgAlbedo = (surfaceMix / 100) * 0.22 + (asphaltPct / 100) * 0.08;
  const evaporativeCooling = (surfaceMix / 100) * 15; // degrees F cooling from transpiration
  const baseTemp = 95; // baseline ambient temp
  const surfaceTemp = baseTemp + (1 - avgAlbedo) * 80 - evaporativeCooling;
  const airTemp = baseTemp + (surfaceTemp - baseTemp) * 0.3 - evaporativeCooling * 0.5;
  const heatDeaths = Math.max(0, (airTemp - 85) * 2.5); // per 100K

  const surfaces = [
    {type: "Fresh Asphalt", albedo: 0.05, peakTemp: 160, color: "#2d3436"},
    {type: "Dark Roof", albedo: 0.08, peakTemp: 170, color: "#636e72"},
    {type: "Concrete", albedo: 0.20, peakTemp: 130, color: "#b2bec3"},
    {type: "Grass", albedo: 0.25, peakTemp: 95, color: "#00b894"},
    {type: "Tree Canopy", albedo: 0.18, peakTemp: 85, color: "#1e6f5c"},
    {type: "Cool Roof", albedo: 0.70, peakTemp: 107, color: "#dfe6e9"}
  ];

  const width = 750;
  const height = 380;
  const svg = d3.create("svg").attr("width", width).attr("height", height);

  svg.append("rect").attr("width", width).attr("height", height).attr("fill", "#f8f9fa").attr("rx", 12);

  // Title
  svg.append("text").attr("x", width/2).attr("y", 25).attr("text-anchor", "middle")
    .attr("font-size", 16).attr("font-weight", "bold")
    .text(`Your Mix: ${surfaceMix}% Vegetation / ${asphaltPct}% Built Surface`);

  // Temperature display
  const tempColor = airTemp > 95 ? "#d63031" : airTemp > 90 ? "#e17055" : airTemp > 85 ? "#fdcb6e" : "#00b894";
  svg.append("rect").attr("x", 50).attr("y", 45).attr("width", 300).attr("height", 70)
    .attr("fill", tempColor).attr("rx", 12).attr("opacity", 0.9);
  svg.append("text").attr("x", 200).attr("y", 72).attr("text-anchor", "middle")
    .attr("font-size", 14).attr("fill", "white").attr("font-weight", "bold").text("Estimated Air Temperature");
  svg.append("text").attr("x", 200).attr("y", 100).attr("text-anchor", "middle")
    .attr("font-size", 24).attr("fill", "white").attr("font-weight", "bold").text(`${airTemp.toFixed(1)}¬∞F`);

  // Health impact
  svg.append("rect").attr("x", 400).attr("y", 45).attr("width", 300).attr("height", 70)
    .attr("fill", heatDeaths > 15 ? "#d63031" : heatDeaths > 5 ? "#e17055" : "#00b894").attr("rx", 12).attr("opacity", 0.9);
  svg.append("text").attr("x", 550).attr("y", 72).attr("text-anchor", "middle")
    .attr("font-size", 14).attr("fill", "white").attr("font-weight", "bold").text("Est. Heat Deaths per 100K");
  svg.append("text").attr("x", 550).attr("y", 100).attr("text-anchor", "middle")
    .attr("font-size", 24).attr("fill", "white").attr("font-weight", "bold").text(`${heatDeaths.toFixed(1)}`);

  // Surface comparison bars
  svg.append("text").attr("x", 15).attr("y", 145).attr("font-size", 13).attr("font-weight", "bold").text("Peak Surface Temperatures by Material:");

  surfaces.forEach((s, i) => {
    const y = 160 + i * 32;
    const barWidth = (s.peakTemp / 180) * 400;
    svg.append("text").attr("x", 15).attr("y", y + 15).attr("font-size", 11).attr("font-weight", "bold").text(s.type);
    svg.append("rect").attr("x", 130).attr("y", y + 2).attr("width", barWidth).attr("height", 20)
      .attr("fill", s.color).attr("rx", 4).attr("opacity", 0.8);
    svg.append("text").attr("x", 135 + barWidth).attr("y", y + 16).attr("font-size", 11)
      .attr("font-weight", "bold").text(`${s.peakTemp}¬∞F (albedo: ${s.albedo})`);
  });

  return svg.node();
}
```

::: {.student-task}
### üìù Investigate the Heat Island

Use the slider above:

1. Set vegetation to **85%** (like pre-colonial Manhattan). What's the estimated air temperature and death rate?
2. Set vegetation to **10%** (like modern Manhattan). How much hotter is it? How many more deaths?
3. At what vegetation percentage does the death rate drop to near zero?
4. Why does dark asphalt reach **160¬∞F** while tree canopy stays at **85¬∞F**? (Hint: think about albedo AND evapotranspiration)
5. In your own words, explain the two mechanisms that make cities hotter than forests.
:::

::: {.key-idea}
### üí° Key Concept: Two Mechanisms of Urban Heat

Cities are hotter than natural areas for two main reasons:

1. **Low albedo (high absorption):** Dark surfaces like asphalt and rooftops absorb 80‚Äì95% of incoming solar radiation, converting it to heat. Natural surfaces reflect more sunlight.

2. **No evaporative cooling:** Trees and plants release water through transpiration, which cools the air (like sweating). Concrete and asphalt can't do this, so all that absorbed energy stays as heat.

Together, these create an **urban heat island** that can be 5‚Äì10¬∞F hotter during the day and up to 22¬∞F hotter at night.
:::

# Explain 1: Building a Computational Model

::: {.explain-box}
## üß† Modeling the Relationship Between Land Use and Heat Deaths

Now that you understand WHY cities are hotter, let's build a model that connects land use ‚Üí temperature ‚Üí health outcomes. This will help you test which solutions work best.
:::

```{ojs}
//| echo: false
viewof modelImperv = Inputs.range([0, 95], {label: "% Impervious surface (asphalt, concrete, buildings)", step: 5, value: 85})
```

```{ojs}
//| echo: false
viewof modelVeg = Inputs.range([0, 60], {label: "% Vegetation cover", step: 5, value: 10})
```

```{ojs}
//| echo: false
viewof modelPop = Inputs.range([1000, 80000], {label: "Population density (people per sq mi)", step: 1000, value: 27000})
```

```{ojs}
//| echo: false
{
  const remaining = 100 - modelImperv - modelVeg;
  const tempIncrease = (modelImperv / 100) * 12 - (modelVeg / 100) * 8;
  const baseTemp = 82;
  const localTemp = baseTemp + tempIncrease;
  const heatIndex = localTemp + (localTemp > 90 ? (localTemp - 90) * 0.5 : 0);
  const deathRate = Math.max(0, (heatIndex - 85) * 2);
  const totalDeaths = (deathRate / 100000) * modelPop * 10; // approximate for an area

  const scenarios = [
    {label: "Pre-colonial (1609)", imperv: 0, veg: 85, temp: 82},
    {label: "Early urban (1800)", imperv: 40, veg: 35, temp: 82 + 40*0.12 - 35*0.08},
    {label: "Industrial (1950)", imperv: 70, veg: 15, temp: 82 + 70*0.12 - 15*0.08},
    {label: "YOUR SCENARIO", imperv: modelImperv, veg: modelVeg, temp: localTemp}
  ];

  const width = 750;
  const height = 400;
  const svg = d3.create("svg").attr("width", width).attr("height", height);

  svg.append("rect").attr("width", width).attr("height", height).attr("fill", "#f0f4ff").attr("rx", 12);
  svg.append("text").attr("x", width/2).attr("y", 25).attr("text-anchor", "middle")
    .attr("font-size", 16).attr("font-weight", "bold").text("Your Land Use ‚Üí Temperature ‚Üí Health Model");

  // Three gauges
  const gauges = [
    {label: "Temperature", value: `${localTemp.toFixed(1)}¬∞F`, sub: `(+${tempIncrease.toFixed(1)}¬∞F from baseline)`,
     color: localTemp > 95 ? "#d63031" : localTemp > 90 ? "#e17055" : localTemp > 85 ? "#fdcb6e" : "#00b894"},
    {label: "Heat Index", value: `${heatIndex.toFixed(1)}¬∞F`, sub: heatIndex > 100 ? "‚ö†Ô∏è DANGEROUS" : heatIndex > 90 ? "‚ö†Ô∏è Caution" : "‚úÖ OK",
     color: heatIndex > 100 ? "#d63031" : heatIndex > 90 ? "#e17055" : "#00b894"},
    {label: "Est. Heat Deaths/100K", value: `${deathRate.toFixed(1)}`, sub: `‚âà ${totalDeaths.toFixed(0)} deaths in this area`,
     color: deathRate > 15 ? "#d63031" : deathRate > 5 ? "#e17055" : "#00b894"}
  ];

  gauges.forEach((g, i) => {
    const x = 50 + i * 240;
    svg.append("rect").attr("x", x).attr("y", 45).attr("width", 210).attr("height", 90)
      .attr("fill", g.color).attr("rx", 12).attr("opacity", 0.9);
    svg.append("text").attr("x", x + 105).attr("y", 70).attr("text-anchor", "middle")
      .attr("font-size", 13).attr("fill", "white").attr("font-weight", "bold").text(g.label);
    svg.append("text").attr("x", x + 105).attr("y", 100).attr("text-anchor", "middle")
      .attr("font-size", 22).attr("fill", "white").attr("font-weight", "bold").text(g.value);
    svg.append("text").attr("x", x + 105).attr("y", 125).attr("text-anchor", "middle")
      .attr("font-size", 11).attr("fill", "white").text(g.sub);
  });

  // Historical comparison chart
  svg.append("text").attr("x", 15).attr("y", 170).attr("font-size", 13).attr("font-weight", "bold")
    .text("Historical Comparison:");

  scenarios.forEach((s, i) => {
    const y = 185 + i * 48;
    const barWidth = Math.max(0, (s.temp - 75) / 25 * 500);
    const isYou = s.label === "YOUR SCENARIO";

    svg.append("text").attr("x", 15).attr("y", y + 16).attr("font-size", 11)
      .attr("font-weight", isYou ? "bold" : "normal").text(s.label);

    svg.append("rect").attr("x", 180).attr("y", y + 2).attr("width", 500).attr("height", 25)
      .attr("fill", "#dfe6e9").attr("rx", 4);
    svg.append("rect").attr("x", 180).attr("y", y + 2).attr("width", Math.min(barWidth, 500)).attr("height", 25)
      .attr("fill", s.temp > 92 ? "#d63031" : s.temp > 87 ? "#e17055" : "#00b894")
      .attr("rx", 4).attr("opacity", 0.8);
    svg.append("text").attr("x", 185 + Math.min(barWidth, 500)).attr("y", y + 19)
      .attr("font-size", 12).attr("font-weight", "bold").text(`${s.temp.toFixed(1)}¬∞F`);
  });

  return svg.node();
}
```

::: {.student-task}
### üìù Run Your Model

Test these scenarios and record the results:

| Scenario | Impervious % | Vegetation % | Temperature | Heat Deaths/100K |
|---|---|---|---|---|
| Pre-colonial (0% imperv, 85% veg) | 0 | 85 | | |
| Early urban (40% imperv, 35% veg) | 40 | 35 | | |
| Current NYC (85% imperv, 10% veg) | 85 | 10 | | |
| Future: no intervention (90%, 8%) | 90 | 8 | | |
| Future: WITH green intervention | ? | ? | | |

For the last row, find a combination that keeps the area urban but reduces heat deaths by at least half.
:::

# Explain 2: Can Urban Greening Fix This?

::: {.explain-box}
## üß† Testing Solutions in Your Model

NYC has already tried urban greening. The MillionTreesNYC program planted 1 million trees by 2017. But was it enough? Let's test it ‚Äî and see what more could be done.
:::

```{ojs}
//| echo: false
viewof treesPlanted = Inputs.range([0, 3000000], {label: "üå≥ Trees planted city-wide", step: 100000, value: 1000000})
```

```{ojs}
//| echo: false
viewof coolRoofPct = Inputs.range([0, 100], {label: "üè† % of rooftops converted to cool/green roofs", step: 5, value: 10})
```

```{ojs}
//| echo: false
viewof parkExpansion = Inputs.range([0, 30], {label: "üåø New park space added (%)", step: 2, value: 2})
```

```{ojs}
//| echo: false
{
  // Model: each million trees ‚âà 5% vegetation increase, each reduces ~1¬∞F
  const treeVegIncrease = (treesPlanted / 1000000) * 5;
  const roofCooling = (coolRoofPct / 100) * 3; // up to 3¬∞F
  const parkCooling = parkExpansion * 0.2; // each 1% park ‚âà 0.2¬∞F

  const totalCooling = (treesPlanted / 1000000) * 1.2 + roofCooling + parkCooling;
  const baseHeatDeaths = 350; // current NYC heat deaths
  const reducedDeaths = Math.max(0, baseHeatDeaths - totalCooling * 40);
  const livesSaved = baseHeatDeaths - reducedDeaths;

  const costs = (treesPlanted / 1000000) * 400 + (coolRoofPct / 100) * 2000 + parkExpansion * 150; // millions

  const width = 750;
  const height = 350;
  const svg = d3.create("svg").attr("width", width).attr("height", height);

  svg.append("rect").attr("width", width).attr("height", height).attr("fill", "#f8f9fa").attr("rx", 12);
  svg.append("text").attr("x", width/2).attr("y", 25).attr("text-anchor", "middle")
    .attr("font-size", 16).attr("font-weight", "bold").text("NYC Urban Cooling Solution Simulator");

  // Key metrics
  const metrics = [
    {label: "Temperature Reduction", value: `${totalCooling.toFixed(1)}¬∞F`, color: totalCooling > 3 ? "#00b894" : "#fdcb6e"},
    {label: "Current Heat Deaths/yr", value: `${baseHeatDeaths}`, color: "#d63031"},
    {label: "Projected Deaths/yr", value: `${reducedDeaths.toFixed(0)}`, color: reducedDeaths < 100 ? "#00b894" : "#e17055"},
    {label: "Lives Saved/yr", value: `${livesSaved.toFixed(0)}`, color: "#00b894"},
    {label: "Est. Cost", value: `$${costs.toFixed(0)}M`, color: "#6c5ce7"}
  ];

  metrics.forEach((m, i) => {
    const x = 15 + i * 148;
    svg.append("rect").attr("x", x).attr("y", 45).attr("width", 138).attr("height", 75)
      .attr("fill", m.color).attr("rx", 10).attr("opacity", 0.85);
    svg.append("text").attr("x", x + 69).attr("y", 70).attr("text-anchor", "middle")
      .attr("font-size", 10).attr("fill", "white").attr("font-weight", "bold").text(m.label);
    svg.append("text").attr("x", x + 69).attr("y", 100).attr("text-anchor", "middle")
      .attr("font-size", 18).attr("fill", "white").attr("font-weight", "bold").text(m.value);
  });

  // Cooling contribution breakdown
  svg.append("text").attr("x", 15).attr("y", 155).attr("font-size", 13).attr("font-weight", "bold").text("Cooling Breakdown:");

  const contributions = [
    {label: "Tree planting", value: (treesPlanted / 1000000) * 1.2, color: "#00b894"},
    {label: "Cool/green roofs", value: roofCooling, color: "#0984e3"},
    {label: "Park expansion", value: parkCooling, color: "#6c5ce7"}
  ];

  contributions.forEach((c, i) => {
    const y = 170 + i * 35;
    svg.append("text").attr("x", 15).attr("y", y + 15).attr("font-size", 11).text(c.label);
    svg.append("rect").attr("x", 150).attr("y", y + 2).attr("width", 400).attr("height", 22)
      .attr("fill", "#dfe6e9").attr("rx", 4);
    svg.append("rect").attr("x", 150).attr("y", y + 2).attr("width", Math.min((c.value / 8) * 400, 400)).attr("height", 22)
      .attr("fill", c.color).attr("rx", 4);
    svg.append("text").attr("x", 560).attr("y", y + 18).attr("font-size", 12).attr("font-weight", "bold")
      .attr("fill", c.color).text(`${c.value.toFixed(1)}¬∞F`);
  });

  // Cost per life saved
  const costPerLife = livesSaved > 0 ? (costs * 1000000) / livesSaved : 0;
  svg.append("text").attr("x", width / 2).attr("y", 310).attr("text-anchor", "middle")
    .attr("font-size", 14).attr("font-weight", "bold")
    .text(livesSaved > 0 ? `Cost per life saved: $${(costPerLife/1000).toFixed(0)}K` : "No lives saved yet ‚Äî increase interventions");

  svg.append("text").attr("x", width / 2).attr("y", 340).attr("text-anchor", "middle")
    .attr("font-size", 12).attr("fill", "#636e72")
    .text(`Biodiversity benefit: +${(treeVegIncrease + parkExpansion).toFixed(0)}% habitat area | Stormwater: ${(coolRoofPct * 0.5 + parkExpansion * 2).toFixed(0)}% improved`);

  return svg.node();
}
```

::: {.student-task}
### üìù Design Your Cooling Solution

1. Start with just the MillionTreesNYC result (1M trees, 10% cool roofs, 2% parks). How many lives are saved?
2. Now **maximize** lives saved while keeping cost under $3,000M. What combination works best?
3. Which single intervention has the biggest impact per dollar?
4. Can you get heat deaths below 50 per year? What does it take?
5. Why might **combining** solutions work better than relying on just one?
:::

# Elaborate: The Amazon Rainforest ‚Äî A Global Warning

::: {.elaborate-box}
## üåé Same Problem, Bigger Scale: Deforestation in the Amazon

The same principles that create urban heat islands are playing out on a massive scale in the Amazon rainforest. But here, the stakes are even higher ‚Äî the Amazon is approaching a **tipping point** that could transform it from a lush forest into a dry savanna.
:::

```{ojs}
//| echo: false
amazonData = [
  {decade: "1970", remaining: 99, annualLoss: 3000},
  {decade: "1980", remaining: 95, annualLoss: 21000},
  {decade: "1990", remaining: 90, annualLoss: 18000},
  {decade: "2000", remaining: 85, annualLoss: 19000},
  {decade: "2010", remaining: 82, annualLoss: 7000},
  {decade: "2020", remaining: 80, annualLoss: 10000}
]

Plot.plot({
  title: "Amazon Rainforest: % Remaining Over Time",
  subtitle: "Scientists estimate the tipping point is at 75-80% remaining (20-25% deforested)",
  width: 750,
  height: 400,
  x: {label: "Decade"},
  y: {label: "% of Original Forest Remaining", domain: [60, 100]},
  marks: [
    Plot.areaY(amazonData, {x: "decade", y: "remaining", fill: "#00b894", fillOpacity: 0.3}),
    Plot.lineY(amazonData, {x: "decade", y: "remaining", stroke: "#00b894", strokeWidth: 3}),
    Plot.dot(amazonData, {x: "decade", y: "remaining", fill: "#1e6f5c", r: 6}),
    Plot.ruleY([80], {stroke: "#d63031", strokeDasharray: "8,4", strokeWidth: 2}),
    Plot.ruleY([75], {stroke: "#d63031", strokeDasharray: "4,4", strokeWidth: 2}),
    Plot.text([{decade: "2020", remaining: 78}], {x: "decade", y: "remaining", text: d => "‚ö†Ô∏è TIPPING POINT ZONE", fill: "#d63031", fontWeight: "bold", fontSize: 12, dx: -60}),
    Plot.text(amazonData, {x: "decade", y: "remaining", text: d => `${d.remaining}%`, dy: -15, fontSize: 12, fontWeight: "bold"})
  ]
})
```

## The Deforestation Feedback Loop

```{ojs}
//| echo: false
viewof deforestRate = Inputs.range([0, 30000], {label: "Annual deforestation rate (km¬≤/year)", step: 1000, value: 10000})
```

```{ojs}
//| echo: false
{
  // Project forward: when does tipping point hit?
  const currentPct = 80;
  const totalArea = 5500000; // km¬≤
  const tippingPoint = 75; // %

  let year = 2025;
  let forestPct = currentPct;
  const projections = [{year: year, pct: forestPct}];
  const annualLossPct = (deforestRate / totalArea) * 100;

  // Feedback: as forest decreases, loss accelerates (less rain, more fire)
  while (year < 2080 && forestPct > 50) {
    year++;
    const feedbackMultiplier = forestPct < 78 ? 1 + (78 - forestPct) * 0.05 : 1;
    forestPct -= annualLossPct * feedbackMultiplier;
    forestPct = Math.max(50, forestPct);
    projections.push({year: year, pct: forestPct});
  }

  const tippingYear = projections.find(d => d.pct <= 75);

  const width = 750;
  const height = 350;
  const svg = d3.create("svg").attr("width", width).attr("height", height);

  svg.append("rect").attr("width", width).attr("height", height).attr("fill", "#f8f9fa").attr("rx", 12);
  svg.append("text").attr("x", width/2).attr("y", 25).attr("text-anchor", "middle")
    .attr("font-size", 16).attr("font-weight", "bold")
    .text(`Amazon Forest Projection at ${deforestRate.toLocaleString()} km¬≤/year Deforestation`);

  // Chart area
  const chartLeft = 80;
  const chartRight = 700;
  const chartTop = 50;
  const chartBottom = 290;
  const chartWidth = chartRight - chartLeft;
  const chartHeight = chartBottom - chartTop;

  // Scales
  const xScale = (yr) => chartLeft + ((yr - 2025) / 55) * chartWidth;
  const yScale = (pct) => chartBottom - ((pct - 50) / 50) * chartHeight;

  // Tipping point zone
  svg.append("rect").attr("x", chartLeft).attr("y", yScale(80)).attr("width", chartWidth)
    .attr("height", yScale(75) - yScale(80)).attr("fill", "#ff767533");
  svg.append("text").attr("x", chartRight - 5).attr("y", yScale(77)).attr("text-anchor", "end")
    .attr("font-size", 10).attr("fill", "#d63031").text("TIPPING POINT ZONE (75-80%)");

  // Axes
  svg.append("line").attr("x1", chartLeft).attr("y1", chartBottom).attr("x2", chartRight).attr("y2", chartBottom)
    .attr("stroke", "#2d3436");
  svg.append("line").attr("x1", chartLeft).attr("y1", chartTop).attr("x2", chartLeft).attr("y2", chartBottom)
    .attr("stroke", "#2d3436");

  // X labels
  for (let yr = 2025; yr <= 2080; yr += 10) {
    svg.append("text").attr("x", xScale(yr)).attr("y", chartBottom + 18).attr("text-anchor", "middle")
      .attr("font-size", 11).text(yr);
  }
  // Y labels
  for (let pct = 50; pct <= 100; pct += 10) {
    svg.append("text").attr("x", chartLeft - 8).attr("y", yScale(pct) + 4).attr("text-anchor", "end")
      .attr("font-size", 11).text(`${pct}%`);
    svg.append("line").attr("x1", chartLeft).attr("y1", yScale(pct)).attr("x2", chartRight).attr("y2", yScale(pct))
      .attr("stroke", "#dfe6e9");
  }

  // Plot line
  const line = d3.line().x(d => xScale(d.year)).y(d => yScale(d.pct));
  svg.append("path").attr("d", line(projections)).attr("fill", "none")
    .attr("stroke", "#00b894").attr("stroke-width", 3);

  // Tipping point marker
  if (tippingYear) {
    svg.append("circle").attr("cx", xScale(tippingYear.year)).attr("cy", yScale(tippingYear.pct))
      .attr("r", 8).attr("fill", "#d63031");
    svg.append("text").attr("x", xScale(tippingYear.year)).attr("y", yScale(tippingYear.pct) - 15)
      .attr("text-anchor", "middle").attr("font-size", 12).attr("font-weight", "bold").attr("fill", "#d63031")
      .text(`Tipping point: ~${tippingYear.year}`);
  }

  // Summary
  svg.append("text").attr("x", width/2).attr("y", 325).attr("text-anchor", "middle")
    .attr("font-size", 13).attr("font-weight", "bold")
    .text(tippingYear
      ? `‚ö†Ô∏è At this rate, the Amazon hits the tipping point around ${tippingYear.year}. After that, feedback loops may make collapse unstoppable.`
      : `At this rate, the Amazon avoids the tipping point through 2080.`);

  return svg.node();
}
```

::: {.student-task}
### üìù Investigate the Tipping Point

1. At the current rate (10,000 km¬≤/year), approximately when does the Amazon hit the tipping point?
2. What deforestation rate keeps the Amazon above 75% through 2080?
3. Why does the decline **accelerate** after entering the tipping point zone? (Think about the feedback loop: less forest ‚Üí less rain ‚Üí more drought ‚Üí more fire ‚Üí less forest)
4. Compare the urban heat island effect to Amazon deforestation. What do they have in common?
5. How are the stakes different? (Hint: the Amazon stores 150‚Äì200 billion tons of carbon and contains 10% of all species on Earth)
:::

# Evaluate: Green Roofs and Combined Solutions

::: {.evaluate-box}
## ‚öñÔ∏è Putting It All Together: Which Land Use Solutions Save the Most Lives?

You've investigated urban heat islands, modeled green solutions, and explored the Amazon tipping point. Now evaluate: which combination of land use solutions would have the greatest combined impact?
:::

```{ojs}
//| echo: false
landSolutions = [
  {solution: "Urban tree planting (1M)", local: 50, biodiversity: 3, climate: 0.5, cost: 400},
  {solution: "Green roofs (50% coverage)", local: 80, biodiversity: 2, climate: 0.3, cost: 2000},
  {solution: "New urban parks (+10%)", local: 60, biodiversity: 4, climate: 0.2, cost: 3000},
  {solution: "Halt Amazon deforestation", local: 0, biodiversity: 10, climate: 8, cost: 5000},
  {solution: "Amazon reforestation (5%)", local: 0, biodiversity: 6, climate: 4, cost: 8000}
]

landSolutionsLong = landSolutions.flatMap(d => [
  {solution: d.solution, metric: "Local Health (lives saved)", value: d.local},
  {solution: d.solution, metric: "Biodiversity (1-10 scale)", value: d.biodiversity},
  {solution: d.solution, metric: "Climate Impact (Gt CO‚ÇÇ)", value: d.climate}
])

Plot.plot({
  title: "Land Use Solutions: Multi-Criteria Comparison",
  subtitle: "Which solutions have the broadest positive impact?",
  width: 750,
  height: 400,
  marginLeft: 200,
  color: {
    domain: ["Local Health (lives saved)", "Biodiversity (1-10 scale)", "Climate Impact (Gt CO‚ÇÇ)"],
    range: ["#e17055", "#00b894", "#0984e3"],
    legend: true
  },
  x: {label: "Impact Score"},
  y: {label: null},
  marks: [
    Plot.barX(landSolutionsLong, Plot.stackX({
      y: "solution",
      x: "value",
      fill: "metric"
    })),
    Plot.ruleX([0])
  ]
})
```

::: {.student-task}
### üìù Combined Impact Analysis

Fill in this table with your best estimates from the investigations in this chapter:

| Solution | Health Impact | Biodiversity Impact | Cost | Feasibility |
|---|---|---|---|---|
| Tree planting (1M trees) | | | | |
| Green roofs (50% coverage) | | | | |
| Halt Amazon deforestation | | | | |
| **COMBINED** | | | | |

Write a 1-paragraph argument: Which land use solutions should be prioritized, and why? Consider:

- Which solutions have the biggest **local** impact?
- Which have the biggest **global** impact?
- Which are most **cost-effective**?
- How does **environmental justice** factor into your decision?
:::

::: {.check-understanding}
### üìã Keep Track for Your Performance Task!

Record the estimated impact of each solution from this chapter:

- ‚úÖ Urban greening (trees, parks) ‚Äî health and biodiversity benefits
- ‚úÖ Green roof technology ‚Äî temperature reduction and co-benefits
- ‚úÖ Deforestation reduction ‚Äî global climate and biodiversity benefits
:::
