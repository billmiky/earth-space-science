---
title: "Unit 4: Earth-Sun Dynamics 5E"
subtitle: "What factors have contributed to climate change in the past and are they contributing to climate change now?"
author: "Earth & Space Science"
format:
  html:
    toc: false
    toc-depth: 3
    number-sections: true
    code-fold: true
execute:
  echo: true
  warning: false
---

```{=html}
<style>
@import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@700&family=Inter:wght@400;600;800&display=swap');

.engage-box { 
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
  color: white;
  padding: 25px; 
  margin: 20px 0; 
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
  border: none;
}
.engage-box h2 { font-family: 'Space Grotesk', sans-serif; font-size: 2em; margin-top: 0; }

.explore-box { 
  background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); 
  color: white;
  padding: 25px; 
  margin: 20px 0; 
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(240, 147, 251, 0.3);
}

.explain-box { 
  background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); 
  color: #1a1a1a;
  padding: 25px; 
  margin: 20px 0; 
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(79, 172, 254, 0.3);
}

.elaborate-box { 
  background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); 
  color: #1a1a1a;
  padding: 25px; 
  margin: 20px 0; 
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(67, 233, 123, 0.3);
}

.evaluate-box { 
  background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); 
  color: #1a1a1a;
  padding: 25px; 
  margin: 20px 0; 
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(250, 112, 154, 0.3);
}

.check-understanding { 
  background: linear-gradient(to right, #667eea, #764ba2);
  color: white;
  padding: 20px; 
  margin: 20px 0;
  border-radius: 12px;
  border-left: 6px solid #fff;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { box-shadow: 0 0 20px rgba(102, 126, 234, 0.5); }
  50% { box-shadow: 0 0 30px rgba(102, 126, 234, 0.8); }
}

.key-idea { 
  background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
  padding: 20px; 
  margin: 20px 0;
  border-radius: 12px;
  border-left: 8px solid #ff6b6b;
  font-size: 1.1em;
}

.lab-activity { 
  background: linear-gradient(to bottom, #ffeaa7, #fdcb6e);
  border: 4px solid #e17055; 
  padding: 25px; 
  margin: 25px 0; 
  border-radius: 15px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.1);
}

.quiz-section { 
  background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
  padding: 25px; 
  margin: 25px 0; 
  border-radius: 15px;
  border: 4px dashed #ff6b6b;
}

.pe-badge { 
  display: inline-block; 
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white; 
  padding: 8px 16px; 
  border-radius: 20px; 
  font-size: 13px; 
  font-weight: 800;
  margin: 5px;
  box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
  text-transform: uppercase;
  letter-spacing: 1px;
}

.big-question {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 2.5em;
  font-weight: 800;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  margin: 30px 0 20px 0;
  text-align: center;
  animation: slideIn 0.8s ease-out;
}

@keyframes slideIn {
  from { opacity: 0; transform: translateY(-20px); }
  to { opacity: 1; transform: translateY(0); }
}

.mind-blown {
  background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
  color: white;
  padding: 20px;
  margin: 20px 0;
  border-radius: 15px;
  font-size: 1.3em;
  font-weight: 700;
  text-align: center;
  box-shadow: 0 10px 25px rgba(255, 107, 107, 0.4);
  animation: bounce 1s ease infinite alternate;
}

@keyframes bounce {
  from { transform: translateY(0); }
  to { transform: translateY(-5px); }
}

h1 { 
  font-family: 'Space Grotesk', sans-serif !important;
  font-weight: 800 !important;
  font-size: 2.8em !important;
  margin-top: 40px !important;
}

h2 { 
  font-family: 'Space Grotesk', sans-serif !important;
  font-weight: 700 !important;
  color: #667eea !important;
}
</style>
```

<span class="pe-badge">HS-ESS2-4</span> <span class="pe-badge">Time: 5 Days</span>

<div class="big-question">ğŸŒ MYSTERY: Earth's Climate Cycles ğŸŒ</div>

::: {.engage-box}
## ğŸ”¬ THE PHENOMENON

<div style="font-size: 1.4em; font-weight: 700; text-align: center; margin: 20px 0; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">
âš¡ The amount of solar radiation hitting 65Â°N has been CYCLING UP AND DOWN for 750,000 years â€” repeating the same pattern every ~100,000 years! âš¡
</div>

### ğŸ¤” THE BIG QUESTIONS:
- ğŸŒ€ Could **natural cycles** be causing today's climate change?
- ğŸ›¸ How has Earth's **position in space** changed over time?
- ğŸ”¥ What happens to Earth's temperature when our orbit shifts?
:::

``` {ojs}
//| echo: false
{
  // 1. Load Plotly
  const Plotly = await require("plotly.js-dist-min");

  // 2. Generate Simulated Data to match the image
  // The graph covers 0 to 350,000 years ago
  const years = d3.range(0, 360, 0.5); 
  
  const data = years.map(t => {
    // A. Insolation (Orange Line): Dominated by Precession (~23k yr cycle)
    // We sum sine waves to mimic the Milankovitch pattern seen in the image
    const precession = Math.sin((t / 23) * 2 * Math.PI) * 25; 
    const obliquity = Math.sin((t / 41) * 2 * Math.PI) * 5;
    const eccentricity = Math.cos((t / 100) * 2 * Math.PI) * 2 + 1; // Modulates the amplitude
    
    // Combine and shift to match the Y-axis range (400-500)
    const insolation = 440 + (precession + obliquity) * eccentricity * 0.4 + (Math.random() * 2);

    // B. Temperature (Black Line): Sawtooth pattern (100k yr cycle)
    // Fast warming (interglacial), slow cooling (glacial)
    const cycle100k = (t % 110) / 110; 
    // Create the "sawtooth" shape seen in ice core data
    let baseTemp = -8 + (Math.exp(-4 * cycle100k) * 10); 
    
    // Add noise and correlation to insolation to make it look real
    const tempNoise = (Math.random() - 0.5) * 1.5;
    const temp = baseTemp + (insolation - 440) * 0.1 + tempNoise;

    return { t, insolation, temp };
  });

  // 3. Define the "Interglacial" (IG) Yellow Highlights
  // These approximate the yellow bars in your image
  const shapes = [
    { type: 'rect', x0: 5, x1: 20, y0: 0, y1: 1, xref: 'x', yref: 'paper', fillcolor: 'gold', opacity: 0.2, line: {width: 0}},
    { type: 'rect', x0: 118, x1: 135, y0: 0, y1: 1, xref: 'x', yref: 'paper', fillcolor: 'gold', opacity: 0.2, line: {width: 0}},
    { type: 'rect', x0: 235, x1: 250, y0: 0, y1: 1, xref: 'x', yref: 'paper', fillcolor: 'gold', opacity: 0.2, line: {width: 0}},
    { type: 'rect', x0: 325, x1: 345, y0: 0, y1: 1, xref: 'x', yref: 'paper', fillcolor: 'gold', opacity: 0.2, line: {width: 0}}
  ];

  // 4. Create Traces
  const traceInsolation = {
    x: data.map(d => d.t),
    y: data.map(d => d.insolation),
    mode: 'lines',
    name: 'July Insolation',
    line: { color: '#e6ac5a', width: 2 }, // Light Orange
    yaxis: 'y2' // Maps to the left axis
  };

  const traceTemp = {
    x: data.map(d => d.t),
    y: data.map(d => d.temp),
    mode: 'lines',
    name: 'Temperature Change',
    line: { color: '#2d3436', width: 1.5 } // Dark Grey/Black
  };

  // 5. Layout Configuration
  const layout = {
    title: { text: "Insolation vs. Temperature (Past 350,000 Years)", font: { size: 18 } },
    height: 500,
    margin: { l: 60, r: 60, t: 50, b: 60 },
    showlegend: false,
    
    // X-Axis: Reversed (Present is 0, on the right)
    xaxis: {
      title: "Years before present (in thousands)",
      autorange: "reversed", 
      range: [350, 0],
      showgrid: false
    },

    // Left Y-Axis (Temperature - Black)
    yaxis: {
      title: "Temperature change from present (Â°C)",
      titlefont: { color: '#2d3436' },
      tickfont: { color: '#2d3436' },
      range: [-12, 6],
      side: 'right' // In Plotly, we often swap sides to match visual preference, usually temp is right in these charts
    },

    // Right Y-Axis (Insolation - Orange)
    yaxis2: {
      title: "July Insolation at 65Â°N (W/mÂ²)",
      titlefont: { color: '#e6ac5a' },
      tickfont: { color: '#e6ac5a' },
      overlaying: 'y', // Important: This overlays the second axis on top of the first
      side: 'left',
      range: [380, 530],
      showgrid: false
    },

    shapes: shapes,

    // Annotations (IG labels and Snowflakes)
    annotations: [
      // IG Labels
      { x: 12, y: 1, yref: 'paper', text: "<b>IG</b>", showarrow: false, font: {color: 'red', size: 12} },
      { x: 126, y: 0.75, yref: 'paper', text: "<b>IG</b>", showarrow: false, font: {color: 'red', size: 12} },
      { x: 242, y: 0.75, yref: 'paper', text: "<b>IG</b>", showarrow: false, font: {color: 'red', size: 12} },
      { x: 335, y: 0.75, yref: 'paper', text: "<b>IG</b>", showarrow: false, font: {color: 'red', size: 12} },
      
      // Snowflakes (Using emoji)
      { x: 60, y: -9, yref: 'y', text: "â„ï¸", showarrow: false, font: {size: 20} },
      { x: 165, y: -9, yref: 'y', text: "â„ï¸", showarrow: false, font: {size: 20} },
      { x: 270, y: -9, yref: 'y', text: "â„ï¸", showarrow: false, font: {size: 20} },
      
      // Legend (Manual placement)
      { x: 350, y: -16, yref: 'y', text: "<b>IG = Inter-glacial</b>", showarrow: false, xanchor: 'left', font: {color: 'red'} },
      { x: 350, y: -18, yref: 'y', text: "<b>â„ï¸ = Glacial</b>", showarrow: false, xanchor: 'left', font: {color: 'blue'} }
    ]
  };

  // 6. Render
  const div = document.createElement('div');
  Plotly.newPlot(div, [traceTemp, traceInsolation], layout, {responsive: true});
  return div;
}
```

# Engage: Solar Radiation Patterns

## Solar Radiation at 65Â°N

Connecting to our earlier questions about how Earth's temperature has varied in the past, let's analyze the total amount of energy from solar radiation reaching Earth at 65Â°N over the last 750,000 years.

```{ojs}
//| echo: false
Plot = require("@observablehq/plot")

// Extended Radiation Data (750k years)
radiationData = [
  {kya: 740, radiation: 460}, {kya: 720, radiation: 490},
  {kya: 700, radiation: 470}, {kya: 680, radiation: 440},
  {kya: 660, radiation: 500}, {kya: 640, radiation: 470},
  {kya: 620, radiation: 450}, {kya: 600, radiation: 480},
  {kya: 580, radiation: 510}, {kya: 560, radiation: 470},
  {kya: 540, radiation: 450}, {kya: 520, radiation: 490},
  {kya: 500, radiation: 460}, {kya: 480, radiation: 520},
  {kya: 460, radiation: 530}, {kya: 440, radiation: 480},
  {kya: 420, radiation: 460}, {kya: 400, radiation: 460}, 
  {kya: 380, radiation: 490}, {kya: 360, radiation: 470}, 
  {kya: 340, radiation: 440}, {kya: 320, radiation: 500}, 
  {kya: 300, radiation: 470}, {kya: 280, radiation: 450}, 
  {kya: 260, radiation: 480}, {kya: 240, radiation: 510}, 
  {kya: 220, radiation: 470}, {kya: 200, radiation: 450}, 
  {kya: 180, radiation: 490}, {kya: 160, radiation: 460}, 
  {kya: 140, radiation: 520}, {kya: 120, radiation: 530}, 
  {kya: 100, radiation: 480}, {kya: 80, radiation: 460}, 
  {kya: 60, radiation: 440}, {kya: 40, radiation: 470}, 
  {kya: 20, radiation: 450}, {kya: 0, radiation: 480}
]

// Vostok ice core data (kept for reference/comparison later)
iceCoreTempData = [
  {kya: 400, temp: -8}, {kya: 380, temp: -4}, {kya: 360, temp: -6},
  {kya: 340, temp: -8}, {kya: 320, temp: -3}, {kya: 300, temp: -6},
  {kya: 280, temp: -8}, {kya: 260, temp: -4}, {kya: 240, temp: -2},
  {kya: 220, temp: -6}, {kya: 200, temp: -8}, {kya: 180, temp: -4},
  {kya: 160, temp: -6}, {kya: 140, temp: -1}, {kya: 120, temp: 2},
  {kya: 100, temp: -4}, {kya: 80, temp: -6}, {kya: 60, temp: -8},
  {kya: 40, temp: -6}, {kya: 20, temp: -8}, {kya: 10, temp: -2},
  {kya: 0, temp: 0}
]
```

```{ojs}
//| echo: false
viewof timeRange = Inputs.range([0, 750], {
  step: 50,
  value: 750,
  label: "View last ___ thousand years:"
})
```

```{ojs}
//| echo: false
filteredRadData = radiationData.filter(d => d.kya <= timeRange)

Plot.plot({
  title: "Summer Radiation at 65Â°N Over the Past " + timeRange + ",000 Years",
  subtitle: "Solar Radiation (Watts/mÂ²)",
  width: 750,
  height: 400,
  x: {label: "Thousands of Years Ago (kya)", reverse: true},
  y: {label: "Radiation (W/mÂ²)", domain: [420, 550]},
  marks: [
    Plot.ruleY([480], {stroke: "#999", strokeDasharray: "4,4"}),
    Plot.areaY(filteredRadData, {x: "kya", y: "radiation", y2: 480, fill: d => d.radiation > 480 ? "#e74c3c" : "#3498db", fillOpacity: 0.4,
        tip: true}),
    Plot.line(filteredRadData, {x: "kya", y: "radiation", stroke: "#2c3e50", strokeWidth: 2,
        tip: true}),
    Plot.dot(filteredRadData.filter(d => d.radiation > 520), {x: "kya", y: "radiation", fill: "red", r: 5,
        tip: true}),
    Plot.text(filteredRadData.filter(d => d.radiation > 520), {x: "kya", y: "radiation", text: d => "Peak", dy: -10, fontSize: 10})
  ]
})
```

::: {.check-understanding}
### ğŸ¯ DETECTIVE MODE: What Do You See?
1. ğŸ” What **repeating pattern** jumps out at you in the last 750,000 years?
2. â° How often does the radiation **peak**?
3. ğŸ§Š Could this pattern explain **Ice Ages**?
:::

<div class="mind-blown">
ğŸ¤¯ WAIT â€” this pattern has been repeating for THREE-QUARTERS OF A MILLION YEARS?! Let's find out WHY... ğŸ¤¯
</div>

# Explore: Earth's Orbital Cycles

## ğŸ¢ The THREE ORBITAL CYCLES

**MISSION:** Use these interactive models to gather evidence about Earth's position in space. Could these orbital wobbles and stretches be causing the 100,000-year radiation pattern we just saw?

<div style="background: linear-gradient(to right, #ff6b6b, #feca57); color: white; padding: 15px; border-radius: 10px; margin: 15px 0; font-weight: 600;">
ğŸ’¡ <strong>DID YOU KNOW?</strong> In 1941, Serbian scientist Milutin Milankovitch figured out that Earth's "wobbles" in space control Ice Ages. Mind = blown! ğŸ¤¯
</div>

### ğŸ”µ Cycle 1: ECCENTRICITY (~100,000 years)

**THE STRETCH:** Earth's orbit changes from nearly circular â­• to more elliptical ğŸ¥š

```{ojs}
//| echo: false
viewof eccentricity = Inputs.range([0, 0.06], {
  step: 0.005,
  value: 0.017,
  label: "Eccentricity (current = 0.017):"
})
```

```{ojs}
//| echo: false
// Draw orbit with variable eccentricity
{
  const width = 500;
  const height = 400;
  const cx = width / 2;
  const cy = height / 2;
  const a = 180; // semi-major axis
  const b = a * Math.sqrt(1 - eccentricity * eccentricity); // semi-minor axis
  const c = a * eccentricity; // focal distance
  
  const svg = d3.create("svg")
    .attr("width", width)
    .attr("height", height);
  
  // Draw orbit ellipse
  svg.append("ellipse")
    .attr("cx", cx + c)
    .attr("cy", cy)
    .attr("rx", a)
    .attr("ry", b)
    .attr("fill", "none")
    .attr("stroke", "#3498db")
    .attr("stroke-width", 2);
  
  // Draw Sun at one focus
  svg.append("circle")
    .attr("cx", cx)
    .attr("cy", cy)
    .attr("r", 20)
    .attr("fill", "#f1c40f");
  
  svg.append("text")
    .attr("x", cx)
    .attr("y", cy + 5)
    .attr("text-anchor", "middle")
    .attr("font-size", "12px")
    .text("â˜€ï¸");
  
  // Draw Earth positions
  svg.append("circle")
    .attr("cx", cx + c + a)
    .attr("cy", cy)
    .attr("r", 10)
    .attr("fill", "#3498db");
  
  svg.append("text")
    .attr("x", cx + c + a)
    .attr("y", cy - 20)
    .attr("text-anchor", "middle")
    .attr("font-size", "10px")
    .text("Aphelion (farthest)");
  
  svg.append("circle")
    .attr("cx", cx + c - a)
    .attr("cy", cy)
    .attr("r", 10)
    .attr("fill", "#2ecc71");
  
  svg.append("text")
    .attr("x", cx + c - a)
    .attr("y", cy - 20)
    .attr("text-anchor", "middle")
    .attr("font-size", "10px")
    .text("Perihelion (closest)");
  
  // Info box
  svg.append("rect")
    .attr("x", 10)
    .attr("y", 10)
    .attr("width", 200)
    .attr("height", 80)
    .attr("fill", "#f5f5f5")
    .attr("rx", 5);
  
  svg.append("text")
    .attr("x", 20)
    .attr("y", 35)
    .attr("font-size", "12px")
    .text(`Eccentricity: ${eccentricity.toFixed(3)}`);
  
  const distDiff = ((2 * a * eccentricity) / a * 100).toFixed(1);
  svg.append("text")
    .attr("x", 20)
    .attr("y", 55)
    .attr("font-size", "12px")
    .text(`Distance variation: ${distDiff}%`);
  
  svg.append("text")
    .attr("x", 20)
    .attr("y", 75)
    .attr("font-size", "11px")
    .attr("fill", "#666")
    .text(`Cycle: ~100,000 years`);
  
  return svg.node();
}
```

### ğŸŒ Cycle 2: OBLIQUITY (Axial Tilt) (~41,000 years)

**THE WOBBLE:** Earth doesn't spin perfectly upright! Our axial tilt changes between 22.1Â° and 24.5Â° â€” affecting how extreme our seasons are! ğŸ¿â„ï¸ğŸ–ï¸

```{ojs}
//| echo: false
viewof tiltAngle = Inputs.range([22.1, 24.5], {
  step: 0.1,
  value: 23.5,
  label: "Axial Tilt (current = 23.5Â°):"
})
```

```{ojs}
//| echo: false
{
  const width = 500;
  const height = 350;
  
  const svg = d3.create("svg")
    .attr("width", width)
    .attr("height", height);
  
  // Draw orbital plane
  svg.append("line")
    .attr("x1", 50)
    .attr("y1", height/2)
    .attr("x2", width - 50)
    .attr("y2", height/2)
    .attr("stroke", "#ccc")
    .attr("stroke-width", 2)
    .attr("stroke-dasharray", "5,5");
  
  svg.append("text")
    .attr("x", width - 100)
    .attr("y", height/2 + 20)
    .attr("font-size", "11px")
    .attr("fill", "#999")
    .text("Orbital Plane");
  
  // Draw Earth
  const earthX = width / 2;
  const earthY = height / 2;
  const earthR = 60;
  
  svg.append("circle")
    .attr("cx", earthX)
    .attr("cy", earthY)
    .attr("r", earthR)
    .attr("fill", "#3498db");
  
  // Draw tilted axis
  const tiltRad = tiltAngle * Math.PI / 180;
  const axisLength = 120;
  
  svg.append("line")
    .attr("x1", earthX - axisLength * Math.sin(tiltRad))
    .attr("y1", earthY + axisLength * Math.cos(tiltRad))
    .attr("x2", earthX + axisLength * Math.sin(tiltRad))
    .attr("y2", earthY - axisLength * Math.cos(tiltRad))
    .attr("stroke", "#e74c3c")
    .attr("stroke-width", 3);
  
  // Angle indicator
  svg.append("text")
    .attr("x", earthX + 70)
    .attr("y", earthY - 80)
    .attr("font-size", "14px")
    .attr("font-weight", "bold")
    .attr("fill", "#e74c3c")
    .text(`${tiltAngle.toFixed(1)}Â°`);
  
  // Effect description
  const effect = tiltAngle > 23.5 ? "MORE extreme seasons" : tiltAngle < 23.5 ? "LESS extreme seasons" : "Current tilt";
  svg.append("rect")
    .attr("x", 20)
    .attr("y", 20)
    .attr("width", 180)
    .attr("height", 60)
    .attr("fill", "#f5f5f5")
    .attr("rx", 5);
  
  svg.append("text")
    .attr("x", 30)
    .attr("y", 45)
    .attr("font-size", "12px")
    .text(`Tilt: ${tiltAngle.toFixed(1)}Â°`);
  
  svg.append("text")
    .attr("x", 30)
    .attr("y", 65)
    .attr("font-size", "11px")
    .attr("fill", "#666")
    .text(effect);
  
  return svg.node();
}
```

### ğŸ”„ Cycle 3: PRECESSION (~23,000 years)

**THE SPIN:** Earth's axis wobbles like a spinning top ğŸŒ€ â€” changing which hemisphere points toward the Sun when we're closest! This affects whether Northern or Southern summers are INTENSE.

```{ojs}
//| echo: false
viewof precessionAngle = Inputs.range([0, 360], {
  step: 15,
  value: 0,
  label: "Precession angle (degrees):"
})
```

```{ojs}
//| echo: false
{
  const width = 450;
  const height = 350;
  
  const svg = d3.create("svg")
    .attr("width", width)
    .attr("height", height);
  
  const cx = width / 2;
  const cy = height / 2;
  
  // Wobble circle (path of North Pole)
  svg.append("ellipse")
    .attr("cx", cx)
    .attr("cy", cy - 80)
    .attr("rx", 50)
    .attr("ry", 20)
    .attr("fill", "none")
    .attr("stroke", "#9b59b6")
    .attr("stroke-width", 2)
    .attr("stroke-dasharray", "5,5");
  
  // Earth
  svg.append("circle")
    .attr("cx", cx)
    .attr("cy", cy)
    .attr("r", 50)
    .attr("fill", "#3498db");
  
  // Wobbling axis
  const precRad = precessionAngle * Math.PI / 180;
  const wobbleX = 30 * Math.cos(precRad);
  const wobbleY = 15 * Math.sin(precRad);
  
  svg.append("line")
    .attr("x1", cx - wobbleX)
    .attr("y1", cy + 100 - wobbleY)
    .attr("x2", cx + wobbleX)
    .attr("y2", cy - 100 + wobbleY)
    .attr("stroke", "#e74c3c")
    .attr("stroke-width", 3);
  
  // North marker
  svg.append("circle")
    .attr("cx", cx + wobbleX)
    .attr("cy", cy - 100 + wobbleY)
    .attr("r", 8)
    .attr("fill", "#e74c3c");
  
  svg.append("text")
    .attr("x", cx + wobbleX + 15)
    .attr("y", cy - 100 + wobbleY)
    .attr("font-size", "12px")
    .text("N");
  
  // Info
  svg.append("rect")
    .attr("x", 10)
    .attr("y", height - 70)
    .attr("width", 200)
    .attr("height", 60)
    .attr("fill", "#f5f5f5")
    .attr("rx", 5);
  
  svg.append("text")
    .attr("x", 20)
    .attr("y", height - 45)
    .attr("font-size", "12px")
    .text(`Precession: ${precessionAngle}Â°`);
  
  svg.append("text")
    .attr("x", 20)
    .attr("y", height - 25)
    .attr("font-size", "11px")
    .attr("fill", "#666")
    .text("Cycle: ~23,000 years");
  
  return svg.node();
}
```

```{=html}
<iframe src="orbital_simulator.html" width="100%" height="1100px" style="border:none;"></iframe>
```

::: {.lab-activity}
## ğŸ”¬ INVESTIGATION LAB: Crack the Climate Code! ğŸ•µï¸

<div style="text-align: center; font-size: 1.3em; font-weight: 700; margin: 15px 0; color: #e17055;">
âš¡ TIME TO BECOME AN ORBITAL DETECTIVE! âš¡
</div>

### ğŸ’ Materials:
- Graph paper or spreadsheet ğŸ“Š
- Colored pencils ğŸ¨
- Calculator ğŸ§®
- Your detective skills ğŸ”

### ğŸ“‹ Mission Steps:

**STEP 1: Analyze the Cycles** ğŸŒ€

1. Use the interactive simulations above to explore each cycle
2. Record observations in your data table:

| Cycle | Period | Current Value | Range | Climate Effect |
|-------|--------|---------------|-------|----------------|
| Eccentricity | ~100,000 yrs | 0.017 | 0.0 - 0.06 | Changes total radiation received |
| Obliquity | ~41,000 yrs | 23.5Â° | 22.1Â° - 24.5Â° | Changes seasonal contrast |
| Precession | ~23,000 yrs | N/A | 360Â° rotation | Changes timing of seasons |

**STEP 2: Connect to the Data** ğŸ“ˆ

Go back and review that radiation graph from the beginning!

1. ğŸ¯ Which cycle's period **matches** the big 100,000-year pattern?
2. ğŸŒŠ Could the other two cycles explain the smaller "wiggles"?

**STEP 3: Make Your Claim** ğŸ¤

<div style="background: white; padding: 15px; border: 3px solid #e17055; border-radius: 10px; margin: 10px 0;">
ğŸ“£ <strong>YOUR VERDICT:</strong> Do Earth's orbital cycles CAUSE those radiation changes? Back it up with EVIDENCE from the models and data!
</div>
:::

# Explain: Connecting Orbit to Climate 

<div class="big-question">ğŸ§Š THE MILLION-DOLLAR QUESTION ğŸ§Š</div>

<div style="text-align: center; font-size: 1.5em; font-weight: 700; margin: 20px 0; color: #667eea;">
Did Earth's orbital wobbles ACTUALLY cause Ice Ages? ğŸ¤”
</div>

::: {.explain-box}
## ğŸŒ THE SECRET MECHANISM REVEALED

<div style="background: rgba(255,255,255,0.3); padding: 15px; border-radius: 10px; margin: 15px 0;">
ğŸ’¥ <strong>PLOT TWIST:</strong> It's not about total yearly radiation â€” it's about **SUMMER** radiation at 65Â°N (high northern latitudes)!
</div>

### Why 65Â°N Matters:
1. Most of Earth's land mass is in the Northern Hemisphere
2. Ice sheets grow when summer is NOT warm enough to melt winter snow
3. When summer radiation at 65Â°N is LOW, ice sheets expand
4. When summer radiation at 65Â°N is HIGH, ice sheets retreat

### The Feedback Loop:
```
Low summer radiation â†’ Snow persists â†’ Ice sheets grow â†’ 
Higher albedo â†’ More cooling â†’ More ice growth
```
:::

## Comparing Radiation and Temperature

```{ojs}
//| echo: false
// Combined visualization
combinedData = iceCoreTempData.map(d => {
  const rad = radiationData.find(r => r.kya === d.kya);
  return {
    kya: d.kya,
    temp: d.temp,
    radiation: rad ? rad.radiation : 480
  };
})

Plot.plot({
  title: "Temperature vs. Summer Radiation at 65Â°N",
  width: 750,
  height: 400,
  x: {label: "Thousands of Years Ago", reverse: true},
  y: {label: "Temperature Anomaly (Â°C)", axis: "left"},
  marks: [
    Plot.line(combinedData, {x: "kya", y: "temp", stroke: "#e74c3c", strokeWidth: 2,
        tip: true}),
    Plot.dot(combinedData.filter(d => d.temp > -2), {x: "kya", y: "temp", fill: "#e74c3c", r: 6,
        tip: true}),
    Plot.text([{x: 350, y: 2}], {x: "x", y: "y", text: d => "Temperature", fill: "#e74c3c", fontSize: 12}),
    
    // Add radiation trend for comparison (scaled to fit)
    Plot.line(combinedData, {x: "kya", y: d => (d.radiation - 480) / 10 - 6, stroke: "#3498db", strokeWidth: 1, strokeDasharray: "4,2",
        tip: true}),
    Plot.text([{x: 350, y: -5}], {x: "x", y: "y", text: d => "Radiation (scaled)", fill: "#3498db", fontSize: 10})
  ]
})
```

::: {.key-idea}
### ğŸ’¡ Key Ideas: Earth-Sun Dynamics

1. **Temperatures on Earth have fluctuated greatly** during human history, marked by glacial and interglacial periods
2. **A pattern exists** in the frequency of these fluctuations (~100,000 years)
3. **The pattern is explained by cyclical changes** in Earth's orbit shape and tilt
4. **These changes cause ice sheets** to expand and retreat
5. **Current orbital parameters suggest Earth should be cooling**, yet global temperatures are increasing
:::

# Elaborate: Solar Activity vs. Glacial Cycles

<div class="big-question">â˜€ï¸ BUT WAIT... WHAT ABOUT THE SUN? â˜€ï¸</div>

## ğŸ”¥ Solar Activity Data

<div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 20px; border-radius: 12px; margin: 20px 0; font-size: 1.1em;">
ğŸ¤” <strong>NEW THEORY ALERT:</strong> Some people say the Sun itself is getting brighter, causing climate change. We know orbital wobbles caused Ice Ages... but what about the Sun's OUTPUT? Let's investigate! ğŸ•µï¸
</div>

```{ojs}
//| echo: false
solarData = [
  {year: 1880, tsi: 1365.5, temp: -0.16},
  {year: 1900, tsi: 1365.7, temp: -0.08},
  {year: 1920, tsi: 1365.6, temp: -0.25},
  {year: 1940, tsi: 1365.8, temp: 0.12},
  {year: 1960, tsi: 1365.9, temp: -0.01},
  {year: 1980, tsi: 1366.1, temp: 0.26},
  {year: 2000, tsi: 1366.0, temp: 0.42},
  {year: 2020, tsi: 1361.0, temp: 1.02}
]

Plot.plot({
  title: "Solar Output (TSI) vs Global Temperature",
  width: 700,
  height: 400,
  x: {label: "Year"},
  marks: [
    Plot.line(solarData, {x: "year", y: d => (d.tsi - 1360) * 2, stroke: "#f1c40f", strokeWidth: 2,
        tip: true}),
    Plot.line(solarData, {x: "year", y: d => d.temp * 3 + 5, stroke: "#e74c3c", strokeWidth: 2,
        tip: true}),
    Plot.text([{x: 1900, y: 12}], {x: "x", y: "y", text: d => "Solar Output", fill: "#f1c40f", fontSize: 12}),
    Plot.text([{x: 1900, y: 7}], {x: "x", y: "y", text: d => "Temperature", fill: "#e74c3c", fontSize: 12})
  ]
})
```

::: {.check-understanding}
### âœ… Analysis Questions
1. Has solar output increased significantly since 1980?
2. Has temperature increased significantly since 1980?
3. Can changes in solar output explain recent warming? Why or why not?
:::

# Evaluate: Are Orbital Factors Causing Warming Today?

<div class="big-question">ğŸš¨ THE FINAL VERDICT ğŸš¨</div>

<div style="text-align: center; font-size: 1.4em; font-weight: 700; margin: 20px 0; color: #fa709a;">
So... are Earth's orbital cycles causing climate change RIGHT NOW? ğŸŒ¡ï¸
</div>

::: {.evaluate-box}
## ğŸ“Š THE EVIDENCE SAYS...

Based on current orbital parameters:

| Parameter | Current Value | Trend | Climate Effect |
|-----------|---------------|-------|----------------|
| Eccentricity | 0.017 | Decreasing | Less seasonal variation |
| Obliquity | 23.44Â° | Decreasing | Less extreme seasons |
| Precession | NH summer at aphelion | Changing slowly | Cooler NH summers |

**Conclusion:** Based on Milankovitch cycles alone, Earth should be gradually cooling. The fact that Earth is warming despite this indicates another factor is at play.

This sets up our next investigation: **What IS causing the warming?**
:::

---

::: {.quiz-section}
## ğŸ® CHALLENGE MODE: Test Your Knowledge! ğŸ†

<div style="text-align: center; font-size: 1.3em; font-weight: 700; margin: 15px 0; color: #ff6b6b;">
ğŸ”¥ Can you ace this quiz? Let's find out! ğŸ”¥
</div>

```{ojs}
//| echo: false
quizData = [
  {
    question: "What is the approximate period of the eccentricity cycle?",
    options: ["23,000 years", "41,000 years", "100,000 years", "1 million years"],
    correct: 2,
    feedback: {
      correct: "ğŸ‰ YES! The eccentricity cycle takes about 100,000 years, which matches the major Ice Age pattern we saw in the data!",
      wrong: "âŒ Not quite! Remember, the eccentricity cycle is the LONGEST of the three Milankovitch cycles. It takes about 100,000 years!"
    }
  },
  {
    question: "Why is summer radiation at 65Â°N latitude so important for ice ages?",
    options: [
      "It's where most people live",
      "It's where most land mass is located, and ice sheets need cool summers to persist",
      "The Sun is closest to Earth at this latitude",
      "Ocean currents are strongest here"
    ],
    correct: 1,
    feedback: {
      correct: "ğŸ’¯ PERFECT! Most land is in the Northern Hemisphere. When summers are cool at 65Â°N, snow doesn't melt and ice sheets GROW!",
      wrong: "âŒ Think about it: Where is most of Earth's land? And what happens if summer isn't warm enough to melt winter snow?"
    }
  },
  {
    question: "Earth's current axial tilt is approximately:",
    options: ["22.1Â°", "23.5Â°", "24.5Â°", "45Â°"],
    correct: 1,
    feedback: {
      correct: "âœ… Spot on! Earth currently tilts at 23.5Â° â€” right in the middle of its range!",
      wrong: "âŒ Close! Earth's tilt right now is 23.5Â°, which is about halfway between the minimum (22.1Â°) and maximum (24.5Â°)."
    }
  },
  {
    question: "According to Milankovitch cycles, what should Earth's climate be doing right now?",
    options: ["Warming rapidly", "Staying constant", "Cooling gradually", "Experiencing an ice age"],
    correct: 2,
    feedback: {
      correct: "ğŸ§  SMART! Based on orbital cycles alone, Earth should be cooling slightly. But it's warming instead â€” which means something ELSE is going on!",
      wrong: "âŒ Actually, our orbital parameters suggest we should be cooling gradually. But we're warming instead... ğŸ¤” Something else must be causing it!"
    }
  },
  {
    question: "What causes the ~100,000 year glacial-interglacial cycle?",
    options: [
      "Changes in the Sun's energy output",
      "Volcanic activity",
      "Changes in Earth's orbital eccentricity",
      "Human activity"
    ],
    correct: 2,
    feedback: {
      correct: "ğŸŒŸ EXCELLENT! Eccentricity â€” the shape of Earth's orbit â€” drives the major 100,000-year cycle!",
      wrong: "âŒ Nope! The 100,000-year cycle matches the eccentricity cycle â€” when Earth's orbit becomes more or less elliptical!"
    }
  },
  {
    question: "The precession cycle affects climate by:",
    options: [
      "Changing total solar radiation received",
      "Changing which season occurs at perihelion vs aphelion",
      "Changing Earth's distance from the Sun",
      "Changing the Sun's output"
    ],
    correct: 1,
    feedback: {
      correct: "ğŸ¯ NAILED IT! Precession changes WHEN (which season) Earth is closest to the Sun, making some hemispheres' summers more intense!",
      wrong: "âŒ Think about what 'wobble' means â€” precession changes which SEASON happens when Earth is closest to or farthest from the Sun!"
    }
  },
  {
    question: "If Earth's axial tilt increased to 24.5Â°, seasons would become:",
    options: ["Less extreme", "More extreme", "Unchanged", "Reversed"],
    correct: 1,
    feedback: {
      correct: "ğŸ’ª YES! Greater tilt = more extreme seasons. Summer gets HOTTER, winter gets COLDER!",
      wrong: "âŒ Remember: Greater tilt means the Northern Hemisphere points MORE toward (or away from) the Sun, making seasons more extreme!"
    }
  },
  {
    question: "What is the significance of global warming occurring despite Milankovitch cycles predicting cooling?",
    options: [
      "Milankovitch cycles are wrong",
      "Another factor must be causing the warming",
      "The Sun's output has increased dramatically",
      "Earth's orbit has changed unexpectedly"
    ],
    correct: 1,
    feedback: {
      correct: "ğŸ”¥ GENIUS! You got it! Orbital cycles say we should cool, but we're warming â€” so something NEW and POWERFUL must be at work!",
      wrong: "âŒ The cycles aren't wrong â€” they've worked for hundreds of thousands of years! The fact that we're warming ANYWAY means a NEW factor is involved..."
    }
  }
]
```

```{ojs}
//| echo: false
viewof answer0 = Inputs.radio(quizData[0].options, {label: `â“ Question 1: ${quizData[0].question}`})
viewof answer1 = Inputs.radio(quizData[1].options, {label: `â“ Question 2: ${quizData[1].question}`})
viewof answer2 = Inputs.radio(quizData[2].options, {label: `â“ Question 3: ${quizData[2].question}`})
viewof answer3 = Inputs.radio(quizData[3].options, {label: `â“ Question 4: ${quizData[3].question}`})
viewof answer4 = Inputs.radio(quizData[4].options, {label: `â“ Question 5: ${quizData[4].question}`})
viewof answer5 = Inputs.radio(quizData[5].options, {label: `â“ Question 6: ${quizData[5].question}`})
viewof answer6 = Inputs.radio(quizData[6].options, {label: `â“ Question 7: ${quizData[6].question}`})
viewof answer7 = Inputs.radio(quizData[7].options, {label: `â“ Question 8: ${quizData[7].question}`})
```

```{ojs}
//| echo: false
mutable showResults = false
```

```{ojs}
//| echo: false
viewof submitButton = Inputs.button("ğŸ¯ Submit Answers & See Your Score!", {
  reduce: () => {
    mutable showResults = true;
    return Date.now();
  }
})
```

```{ojs}
//| echo: false
userAnswers = [answer0, answer1, answer2, answer3, answer4, answer5, answer6, answer7]

score = showResults ? userAnswers.reduce((sum, ans, i) => {
  const answerIndex = quizData[i].options.indexOf(ans);
  return sum + (answerIndex === quizData[i].correct ? 1 : 0);
}, 0) : null

percentage = score !== null ? Math.round((score / quizData.length) * 100) : null
```

```{ojs}
//| echo: false
showResults ? html`
<div>
  ${quizData.map((q, i) => {
    const userAnswer = userAnswers[i];
    const answerIndex = q.options.indexOf(userAnswer);
    const isCorrect = answerIndex === q.correct;
    const answered = userAnswer !== undefined;
    const bgColor = !answered ? "#f5f5f5" : isCorrect ? "#d4edda" : "#ffebee";
    const borderColor = !answered ? "#ccc" : isCorrect ? "#28a745" : "#dc3545";
    const icon = !answered ? "âš ï¸" : isCorrect ? "âœ…" : "âŒ";
    
    return html`
      <div style="background: ${bgColor}; border: 3px solid ${borderColor}; padding: 15px; margin: 15px 0; border-radius: 10px;">
        <strong>${icon} Question ${i + 1}:</strong> ${q.question}<br/>
        <strong>Your answer:</strong> ${answered ? userAnswer : "Not answered"}<br/>
        <strong>Correct answer:</strong> ${q.options[q.correct]}<br/>
        <div style="margin-top: 10px; font-style: italic; color: #333;">
          ${isCorrect ? q.feedback.correct : q.feedback.wrong}
        </div>
      </div>
    `;
  })}
  
  <div style="background: linear-gradient(135deg, ${percentage >= 80 ? '#43e97b' : percentage >= 60 ? '#feca57' : '#fa709a'} 0%, ${percentage >= 80 ? '#38f9d7' : percentage >= 60 ? '#ff6b6b' : '#fee140'} 100%); color: ${percentage >= 60 ? '#1a1a1a' : 'white'}; padding: 25px; margin: 25px 0; border-radius: 15px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
    <div style="font-size: 2.5em; font-weight: 800; margin-bottom: 10px;">
      ${percentage >= 80 ? 'ğŸ†' : percentage >= 60 ? 'ğŸ‘' : 'ğŸ“š'}
    </div>
    <div style="font-size: 2em; font-weight: 700; margin-bottom: 15px;">
      Your Score: ${score}/${quizData.length} (${percentage}%)
    </div>
    <div style="font-size: 1.3em; font-weight: 600;">
      ${percentage >= 80 ? 
        "ğŸŒŸ ORBITAL EXPERT! You've mastered Earth-Sun dynamics! You're ready to explain Ice Ages to anyone!" : 
        percentage >= 60 ? 
        "ğŸ’ª SOLID WORK! You understand the basics. Review those tricky concepts and you'll be an expert!" : 
        "ğŸ”„ KEEP LEARNING! These concepts are tough. Go back through the chapter, play with the simulations, and try again!"}
    </div>
  </div>
</div>
` : html`<div style="text-align: center; padding: 20px; color: #666; font-style: italic;">
  ğŸ“ Answer all questions above, then click "Submit Answers" to see how you did!
</div>`
```

:::

---