---
title: "Unit 4: Climate Feedbacks 5E"
subtitle: "What is causing global temperatures to rise, and why is the Arctic warming at almost 4 times the rate as the rest of the globe?"
author: "Earth & Space Science"
format:
  html:
    toc: false
    toc-depth: 3
    number-sections: true
    code-fold: true
execute:
  echo: true
  warning: false
---

```{=html}
<style>
.engage-box { background: #e3f2fd; border-left: 5px solid #2196F3; padding: 20px; margin: 15px 0; border-radius: 0 10px 10px 0; }
.explore-box { background: #fff3e0; border-left: 5px solid #ff9800; padding: 20px; margin: 15px 0; border-radius: 0 10px 10px 0; }
.explain-box { background: #e8f5e9; border-left: 5px solid #4caf50; padding: 20px; margin: 15px 0; border-radius: 0 10px 10px 0; }
.elaborate-box { background: #f3e5f5; border-left: 5px solid #9c27b0; padding: 20px; margin: 15px 0; border-radius: 0 10px 10px 0; }
.evaluate-box { background: #ffebee; border-left: 5px solid #f44336; padding: 20px; margin: 15px 0; border-radius: 0 10px 10px 0; }
.check-understanding { background-color: #d1ecf1; border-left: 5px solid #17a2b8; padding: 15px; margin: 15px 0; }
.key-idea { background-color: #d4edda; border-left: 5px solid #28a745; padding: 15px; margin: 15px 0; }
.lab-activity { background: #fafafa; border: 2px solid #333; padding: 20px; margin: 20px 0; border-radius: 10px; }
.quiz-section { background-color: #f8d7da; border-left: 5px solid #dc3545; padding: 20px; margin: 20px 0; border-radius: 10px; }
.feedback-loop { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 15px; margin: 20px 0; }
.pe-badge { display: inline-block; background: #673ab7; color: white; padding: 5px 10px; border-radius: 5px; font-size: 12px; margin: 5px; }
</style>
```

<span class="pe-badge">HS-ESS2-2</span> <span class="pe-badge">HS-ESS2-4</span> <span class="pe-badge">HS-ESS2-6</span> <span class="pe-badge">Time: 7-9 Days</span>

# Investigative Phenomenon

::: {.engage-box}
## üå°Ô∏è Arctic Amplification

**The globe is warming, and the average temperature of the Arctic is increasing at almost 4 times the rate as the rest of the globe.**

### Driving Questions:
- What is causing global temperatures to rise today?
- Why is the Arctic warming almost 4x faster than the rest of the globe?
- How do feedbacks (like greenhouse gases and ice) amplify or reduce change?
- How do greenhouse gas increases connect to glacial cycles and current warming?
:::

# Engage: Arctic vs Global Warming

What is happening to temperatures and Arctic ice today? Use the graph below to compare warming in the Arctic to the global average and surface student questions about the current climate change that orbital factors did not explain in the previous lesson.

```{ojs}
//| echo: false
// Ensure we are grabbing a version of Plot that supports tooltips
Plot = require("@observablehq/plot@0.6.13")

arcticData = [
  {year: 1980, global: 0.26, arctic: 0.4},
  {year: 1985, global: 0.12, arctic: 0.3},
  {year: 1990, global: 0.45, arctic: 0.8},
  {year: 1995, global: 0.45, arctic: 0.9},
  {year: 2000, global: 0.42, arctic: 1.0},
  {year: 2005, global: 0.69, arctic: 1.5},
  {year: 2010, global: 0.72, arctic: 1.8},
  {year: 2015, global: 0.90, arctic: 2.5},
  {year: 2020, global: 1.02, arctic: 3.2},
  {year: 2024, global: 1.29, arctic: 4.1}
]

Plot.plot({
  title: "Temperature Change: Arctic vs Global Average",
  subtitle: "Anomaly relative to 1951-1980 baseline (¬∞C)",
  width: 700,
  height: 400,
  y: {label: "Temperature Anomaly (¬∞C)", domain: [0, 4.5]},
  x: {label: "Year", tickFormat: "d"}, // Format year to avoid commas (e.g. 2,020)
  color: {legend: true},
  marks: [
    // 1. Add a vertical scanning line that follows the mouse (pointerX)
    Plot.ruleX(arcticData, Plot.pointerX({x: "year", stroke: "gray", strokeOpacity: 0.5})),

    // ARCTIC LINE & DOTS
    Plot.line(arcticData, {x: "year", y: "arctic", stroke: "#3498db", strokeWidth: 3}),
    Plot.dot(arcticData, {
      x: "year", 
      y: "arctic", 
      fill: "#3498db", 
      r: 6,
      // 2. Enable Tooltip
      tip: true,
      // 3. Rename tooltip labels (so it doesn't say 'y: 4.1')
      channels: {Temp: "arctic", Year: "year"}
    }),

    // GLOBAL LINE & DOTS
    Plot.line(arcticData, {x: "year", y: "global", stroke: "#e74c3c", strokeWidth: 3}),
    Plot.dot(arcticData, {
      x: "year", 
      y: "global", 
      fill: "#e74c3c", 
      r: 6,
      tip: true,
      channels: {Temp: "global", Year: "year"}
    }),

    // Text labels (Static)
    Plot.text([{x: 2010, y: 2.3}], {x: "x", y: "y", text: d => "Arctic", fill: "#3498db", fontSize: 14, fontWeight: "bold"}),
    Plot.text([{x: 2010, y: 0.5}], {x: "x", y: "y", text: d => "Global", fill: "#e74c3c", fontSize: 14, fontWeight: "bold"})
  ]
})
```

::: {.check-understanding}
### ü§î Initial Questions
1. How much faster is the Arctic warming compared to the global average?
2. What evidence from the graph suggests the Arctic is changing more rapidly?
3. What changes in the Arctic might amplify or reduce this warming trend?
:::

``` {python}
#| label: fig-co2-temp-800ka
#| fig-cap: "Atmospheric CO‚ÇÇ concentration and Antarctic temperature over the past 800,000 years, showing strong correlation during glacial-interglacial cycles and unprecedented current CO‚ÇÇ levels."
#| echo: false
#| warning: false

import plotly.graph_objects as go
from plotly.subplots import make_subplots
import pandas as pd
import numpy as np
from scipy.interpolate import interp1d

# Climate data over 800,000 years
time_ka = np.array([
    800, 750, 700, 650, 600, 550, 500, 450, 400, 350, 
    300, 250, 200, 150, 100, 50, 0
])

# CO‚ÇÇ concentrations (ppm) showing glacial-interglacial cycles
co2_ppm = np.array([
    190, 220, 190, 240, 190, 270, 210, 280, 200, 260, 
    190, 280, 200, 240, 200, 280, 420
])

# Antarctic temperature anomaly (¬∞C)
temp_anomaly = np.array([
    -8, -4, -9, -2, -8, 2, -7, 4, -8, 0, 
    -9, 2, -8, -2, -6, 0, 0
])

# Create smoother curves
time_dense = np.linspace(800, 0, 200)
co2_interp = interp1d(time_ka, co2_ppm, kind="cubic")
temp_interp = interp1d(time_ka, temp_anomaly, kind="cubic")

co2_dense = co2_interp(time_dense)
temp_dense = temp_interp(time_dense)

# Add natural variability
np.random.seed(42)
co2_dense += np.random.normal(0, 5, len(co2_dense))
temp_dense += np.random.normal(0, 0.5, len(temp_dense))

# Mark current CO‚ÇÇ
co2_dense[-1] = 420

df = pd.DataFrame({
    "Time_ka": time_dense,
    "CO2": co2_dense,
    "Temperature": temp_dense
})

# Create dual-axis figure
fig = make_subplots(specs=[[{"secondary_y": True}]])

# CO‚ÇÇ data (BLUE)
fig.add_trace(
    go.Scatter(
        x=df["Time_ka"], y=df["CO2"],
        mode="lines", name="Atmospheric CO‚ÇÇ",
        line=dict(color="rgb(40, 120, 200)", width=2),
        hovertemplate="<b>CO‚ÇÇ</b><br>%{x:.0f}k years ago<br>%{y:.0f} ppm<extra></extra>"
    ),
    secondary_y=False
)

# Temperature data (ORANGE)
fig.add_trace(
    go.Scatter(
        x=df["Time_ka"], y=df["Temperature"],
        mode="lines", name="Antarctic Temperature",
        line=dict(color="rgb(230, 140, 50)", width=2),
        hovertemplate="<b>Temperature</b><br>%{x:.0f}k years ago<br>%{y:.1f}¬∞C<extra></extra>"
    ),
    secondary_y=True
)

# Current CO‚ÇÇ marker
fig.add_trace(
    go.Scatter(
        x=[0], y=[420],
        mode="markers+text",
        marker=dict(size=12, color="red"),
        text=["Current<br>420 ppm"],
        textposition="top center",
        textfont=dict(size=11, color="red"),
        hovertemplate="<b>Current (2026)</b><br>420 ppm<extra></extra>",
        showlegend=False
    ),
    secondary_y=False
)

# Layout
fig.update_layout(
    title="CO‚ÇÇ and Antarctic Temperature over 800,000 Years",
    xaxis=dict(title="Years ago (in thousands)", 
               autorange="reversed", gridcolor="lightgray"),
    hovermode="x unified",
    plot_bgcolor="white",
    legend=dict(x=0.02, y=0.98, bgcolor="rgba(255, 255, 255, 0.9)",
                bordercolor="gray", borderwidth=1),
    height=600
)

fig.update_yaxes(
    title_text="Atmospheric CO‚ÇÇ (ppm)",
    secondary_y=False, gridcolor="lightgray", range=[150, 450]
)

fig.update_yaxes(
    title_text="Temperature Anomaly (¬∞C)",
    secondary_y=True, showgrid=False, range=[-12, 8]
)

fig
```

# Explore Part 1: The Greenhouse Effect

How do carbon dioxide levels in the air both impact and change as a result of Earth‚Äôs systems? Use the simulation to gather evidence about the causal mechanism behind the correlation between atmospheric CO‚ÇÇ levels and climate factors like temperature.

### Carbon Cycle Model: Pre vs. Post Industrial

Use the sliders below to simulate the flow of carbon. 
1. Keep **Fossil Fuel Burning** at **0** to see the Pre-Industrial equilibrium.
2. Increase the burning rate to see how the **Atmosphere** reservoir changes over time.

```{ojs}
//| echo: false

// --- 1. INTERACTIVE INPUTS ---
viewof years = Inputs.range([0, 100], {label: "Years Elapsed", step: 1, value: 0});
viewof human_emissions = Inputs.range([0, 15], {label: "Fossil Fuel Burning (Gt/year)", step: 0.5, value: 0});

// --- 2. THE MATH MODEL ---
// Initial Stocks (Table 1)
init_atmos = 560;
init_ocean = 38000;
init_bio = 2160;
init_fossil = 10000;

// Flows (Table 2) - Constant Linear Rates
// Note: In reality, flows change with concentration, but for this high school model we use the fixed rates provided.
flow_ocean_to_atmos = 62;
flow_atmos_to_ocean = 60;
flow_bio_to_atmos = 107;
flow_atmos_to_bio = 109;

// Calculate Current State
current_fossil = init_fossil - (human_emissions * years);

// Net Flux to Atmosphere = (In from Ocean + In from Bio + Human) - (Out to Ocean + Out to Bio)
yearly_atmos_change = (flow_ocean_to_atmos + flow_bio_to_atmos + human_emissions) - (flow_atmos_to_ocean + flow_atmos_to_bio);
current_atmos = init_atmos + (yearly_atmos_change * years);

// Net Flux to Ocean (In - Out)
current_ocean = init_ocean + ((flow_atmos_to_ocean - flow_ocean_to_atmos) * years);

// Net Flux to Bio (In - Out)
current_bio = init_bio + ((flow_atmos_to_bio - flow_bio_to_atmos) * years);

// --- 3. THE VISUALIZATION (SVG) ---
htl.html`<svg width="600" height="450" viewBox="0 0 600 450" style="font-family: sans-serif;">
  
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666" />
    </marker>
  </defs>

  <text x="300" y="30" text-anchor="middle" font-size="18" font-weight="bold" fill="#333">
    ${human_emissions == 0 ? "Pre-Industrial Equilibrium" : "Post-Industrial Disruption"}
  </text>

  <g transform="translate(200, 50)">
    <rect x="0" y="0" width="200" height="80" rx="10" fill="#E3F2FD" stroke="#2196F3" stroke-width="2"/>
    <text x="100" y="30" text-anchor="middle" font-weight="bold">ATMOSPHERE</text>
    <text x="100" y="55" text-anchor="middle" font-size="20" fill="#D32F2F" font-weight="bold">
      ${current_atmos.toFixed(0)} Gt
    </text>
  </g>

  <g transform="translate(380, 250)">
    <rect x="0" y="0" width="180" height="80" rx="10" fill="#E0F7FA" stroke="#00BCD4" stroke-width="2"/>
    <text x="90" y="30" text-anchor="middle" font-weight="bold">OCEAN</text>
    <text x="90" y="55" text-anchor="middle" font-size="16">
      ${current_ocean.toFixed(0)} Gt
    </text>
  </g>

  <g transform="translate(40, 250)">
    <rect x="0" y="0" width="180" height="80" rx="10" fill="#E8F5E9" stroke="#4CAF50" stroke-width="2"/>
    <text x="90" y="30" text-anchor="middle" font-weight="bold">BIOSPHERE</text>
    <text x="90" y="55" text-anchor="middle" font-size="16">
      ${current_bio.toFixed(0)} Gt
    </text>
  </g>

  <g transform="translate(200, 370)">
    <rect x="0" y="0" width="200" height="60" rx="10" fill="#424242" stroke="#000" stroke-width="2"/>
    <text x="100" y="25" text-anchor="middle" fill="white" font-weight="bold">FOSSIL FUELS</text>
    <text x="100" y="45" text-anchor="middle" fill="white" font-size="14">
      ${current_fossil.toFixed(1)} Gt
    </text>
  </g>

  <line x1="140" y1="250" x2="220" y2="130" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="150" y="190" font-size="10" fill="#666">107</text>
  
  <line x1="240" y1="130" x2="160" y2="250" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="210" y="200" font-size="10" fill="#666">109</text>

  <line x1="440" y1="250" x2="360" y2="130" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="410" y="200" font-size="10" fill="#666">62</text>

  <line x1="380" y1="130" x2="460" y2="250" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="430" y="190" font-size="10" fill="#666">60</text>

  ${human_emissions > 0 ? htl.html`
    <line x1="300" y1="370" x2="300" y2="140" stroke="#D32F2F" stroke-width="4" marker-end="url(#arrowhead)" stroke-dasharray="5,5"/>
    <text x="310" y="300" font-size="12" fill="#D32F2F" font-weight="bold">+ ${human_emissions} Gt/yr</text>
  ` : ""}

</svg>`
```

## Modeling the Effect of the Carbon Cycle on Temperature

Explore how greenhouse gases trap heat in Earth's atmosphere:

```{=html}
<style>
  .phet-launch {
    max-width: 920px;
    margin: 20px auto;
  }
  .phet-card {
    display: block;
    border-radius: 14px;
    border: 1px solid rgba(0,0,0,.12);
    background: #fff;
    overflow: hidden;
    text-decoration: none;
    box-shadow: 0 10px 30px rgba(0,0,0,.10);
    transition: transform .15s ease, box-shadow .15s ease;
  }
  .phet-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 16px 44px rgba(0,0,0,.14);
  }
  .phet-card svg {
    width: 100%;
    height: auto;
    display: block;
  }
  .phet-actions {
    display: flex;
    gap: 10px;
    align-items: center;
    justify-content: center;
    margin-top: 12px;
    flex-wrap: wrap;
  }
  .phet-btn {
    display: inline-block;
    background: #2563eb;
    color: #fff;
    padding: 10px 14px;
    border-radius: 999px;
    font-weight: 700;
    text-decoration: none;
  }
  .phet-btn:hover { filter: brightness(0.95); }
  .phet-note {
    margin-top: 10px;
    font-size: 12px;
    color: #666;
    line-height: 1.4;
    text-align: center;
  }
</style>

<div class="phet-launch">
  <a class="phet-card" href="https://phet.colorado.edu/sims/html/greenhouse-effect/latest/greenhouse-effect_en.html" target="_blank" rel="noopener">
    <svg viewBox="0 0 1200 675" role="img" aria-label="Launch PhET Greenhouse Effect simulation">
      <defs>
        <linearGradient id="bg" x1="0" x2="1" y1="0" y2="1">
          <stop offset="0" stop-color="#0ea5e9"/>
          <stop offset="1" stop-color="#7c3aed"/>
        </linearGradient>
        <linearGradient id="glow" x1="0" x2="0" y1="0" y2="1">
          <stop offset="0" stop-color="#ffffff" stop-opacity=".95"/>
          <stop offset="1" stop-color="#ffffff" stop-opacity=".75"/>
        </linearGradient>
        <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
          <feDropShadow dx="0" dy="12" stdDeviation="18" flood-color="#000" flood-opacity=".28"/>
        </filter>
      </defs>

      <rect width="1200" height="675" fill="url(#bg)"/>
      <circle cx="220" cy="160" r="110" fill="#fde047" opacity=".95"/>
      <circle cx="220" cy="160" r="170" fill="#fde047" opacity=".22"/>
      <circle cx="220" cy="160" r="240" fill="#fde047" opacity=".10"/>

      <path d="M0 520 C180 420, 280 640, 520 540 C760 440, 920 660, 1200 520 L1200 675 L0 675 Z" fill="#0b1220" opacity=".35"/>
      <path d="M0 560 C220 470, 300 650, 560 570 C820 490, 940 650, 1200 580 L1200 675 L0 675 Z" fill="#0b1220" opacity=".25"/>

      <g filter="url(#shadow)">
        <rect x="90" y="180" width="1020" height="340" rx="24" fill="url(#glow)"/>
      </g>

      <text x="140" y="260" font-family="system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif" font-size="44" font-weight="800" fill="#0b1220">
        PhET Simulation: Greenhouse Effect
      </text>
      <text x="140" y="312" font-family="system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif" font-size="26" font-weight="600" fill="#0b1220" opacity=".82">
        Click to open in a new tab (works even if embeds are blocked)
      </text>

      <g transform="translate(140 360)">
        <rect x="0" y="0" width="360" height="86" rx="43" fill="#2563eb"/>
        <polygon points="64,22 64,64 102,43" fill="#fff"/>
        <text x="130" y="55" font-family="system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif" font-size="28" font-weight="800" fill="#fff">
          Launch Sim
        </text>
      </g>

      <text x="90" y="610" font-family="system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif" font-size="18" fill="#fff" opacity=".88">
        Tip: if your school network blocks the site, use the link below.
      </text>
    </svg>
  </a>

  <div class="phet-actions">
    <a class="phet-btn" href="https://phet.colorado.edu/sims/html/greenhouse-effect/latest/greenhouse-effect_en.html" target="_blank" rel="noopener">Open the simulation</a>
    <a class="phet-btn" style="background:#0f172a" href="https://phet.colorado.edu/en/simulations/greenhouse-effect" target="_blank" rel="noopener">PhET sim page</a>
  </div>

  <p class="phet-note">
    Some previews (and some LMS pages) block external iframes, so this lesson uses a click-to-open launch card instead of an embed.
  </p>
</div>
```

::: {.explore-box}
### üî¨ Simulation Investigation Tasks

**Task 1: Explore the Greenhouse Effect**
1. Start with "Waves" mode to see how infrared radiation interacts with greenhouse gases
2. Compare Earth's temperature with NO greenhouse gases vs. with greenhouse gases
3. Record the equilibrium temperature for each scenario

**Task 2: Compare Different Atmospheres**
1. Try the Ice Age atmosphere setting
2. Try the 1750 (pre-industrial) setting
3. Try the "Today" setting
4. Record how temperature changes with different CO‚ÇÇ levels

**Task 3: Photon Absorption**
1. Switch to "Photons" mode
2. Observe what happens when infrared photons encounter CO‚ÇÇ molecules
3. Explain why more CO‚ÇÇ = more warming
:::

## CO‚ÇÇ and Temperature: The Evidence

### Ice Core Data: 800,000 Years of CO‚ÇÇ and Temperature

```{ojs}
//| echo: false
// Ice core CO2 and temperature data
iceCoreData = [
  {kya: 800, co2: 190, temp: -8},
  {kya: 700, co2: 210, temp: -6},
  {kya: 600, co2: 240, temp: -4},
  {kya: 500, co2: 200, temp: -7},
  {kya: 400, co2: 180, temp: -9},
  {kya: 350, co2: 200, temp: -6},
  {kya: 300, co2: 240, temp: -3},
  {kya: 250, co2: 200, temp: -7},
  {kya: 200, co2: 190, temp: -8},
  {kya: 150, co2: 220, temp: -5},
  {kya: 130, co2: 280, temp: 2},
  {kya: 100, co2: 230, temp: -4},
  {kya: 50, co2: 200, temp: -6},
  {kya: 20, co2: 180, temp: -9},
  {kya: 10, co2: 260, temp: -1},
  {kya: 0.2, co2: 280, temp: 0},
  {kya: 0, co2: 420, temp: 1.2}
]
```

```{ojs}
//| echo: false
viewof showModern = Inputs.toggle({label: "Show modern CO‚ÇÇ level (420 ppm)", value: false})
```

```{ojs}
//| echo: false
displayData = showModern ? iceCoreData : iceCoreData.filter(d => d.kya > 0.1)

Plot.plot({
  title: "CO‚ÇÇ Concentration Over 800,000 Years",
  subtitle: "Data from Antarctic ice cores",
  width: 750,
  height: 350,
  x: {label: "Thousands of Years Ago", reverse: true, domain: [800, 0]},
  y: {label: "CO‚ÇÇ (ppm)", domain: [150, showModern ? 450 : 320]},
  marks: [
    Plot.ruleY([280], {stroke: "#999", strokeDasharray: "4,4"}),
    Plot.line(displayData, {x: "kya", y: "co2", stroke: "#27ae60", strokeWidth: 2}),
    Plot.dot(displayData.filter(d => d.kya === 0), {x: "kya", y: "co2", fill: "#e74c3c", r: 10}),
    Plot.text([{x: 400, y: 295}], {x: "x", y: "y", text: d => "Pre-industrial maximum: 280 ppm", fill: "#999", fontSize: 11}),
    showModern ? Plot.text([{x: 50, y: 420}], {x: "x", y: "y", text: d => "TODAY: 420 ppm", fill: "#e74c3c", fontSize: 12, fontWeight: "bold"}) : null
  ].filter(d => d !== null)
})
```

::: {.check-understanding}
### ‚úÖ Data Analysis
1. What is the highest CO‚ÇÇ level in the past 800,000 years (before humans)?
2. What is today's CO‚ÇÇ level?
3. How does today's CO‚ÇÇ compare to the natural range?
4. What pattern do you notice between CO‚ÇÇ and temperature in the ice core record?
5. Based on these data, make a claim about how CO‚ÇÇ levels and temperature are related.
:::

# Explore Part 2: The Albedo Effect

How is the icy surface of the poles changing, and what does that do to Earth's temperature? Analyze albedo models and datasets to figure out how different surfaces change the surrounding system and impact temperature.

## What is Albedo?

**Albedo** is the measure of how much light a surface reflects. It ranges from 0 (absorbs all light) to 1 (reflects all light).

``` {python}
#| label: fig-glacier-comparison
#| fig-cap: "Interactive comparison of Frederiksdal Glacier, Greenland between June 14 and July 24, 2023, showing dramatic ice loss over 40 days."
#| echo: false
#| warning: false

from IPython.display import HTML, display

html_code = """
<style>
    .comparison-container {
        position: relative;
        width: 100%;
        max-width: 800px;
        margin: 20px auto;
        overflow: hidden;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }
    
    .comparison-container img {
        display: block;
        width: 100%;
        height: auto;
    }
    
    .base-image {
      position: relative;
      width: 100%;
      display: block;
    }

    .overlay-image {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 50%;
        height: 100%;
        overflow: hidden;
    }
    
    .slider {
        position: absolute;
        top: 0;
        left: 50%;
        width: 4px;
        height: 100%;
        background: white;
        cursor: ew-resize;
        transform: translateX(-50%);
        z-index: 10;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    }
    
    .slider-button {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 50px;
        height: 50px;
        background: white;
        border-radius: 50%;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: ew-resize;
    }
    
    .slider-button::before,
    .slider-button::after {
        content: '';
        position: absolute;
        width: 0;
        height: 0;
        border-style: solid;
    }
    
    .slider-button::before {
        left: 12px;
        border-width: 8px 12px 8px 0;
        border-color: transparent #2c3e50 transparent transparent;
    }
    
    .slider-button::after {
        right: 12px;
        border-width: 8px 0 8px 12px;
        border-color: transparent transparent transparent #2c3e50;
    }
    
    .labels {
        position: absolute;
        top: 20px;
        width: 100%;
        display: flex;
        justify-content: space-between;
        padding: 0 20px;
        pointer-events: none;
        z-index: 5;
    }
    
    .label {
        background: rgba(255, 255, 255, 0.9);
        padding: 8px 16px;
        border-radius: 6px;
        font-weight: 600;
        color: #2c3e50;
        font-size: 14px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    
    .instructions {
        text-align: center;
        margin-top: 15px;
        color: #7f8c8d;
        font-size: 14px;
        font-style: italic;
    }
</style>

<div class="comparison-container" id="comparison">
  <img src="../images/glacier_june_2023.JPG" 
     alt="June 14, 2023 (base image)" 
     class="base-image">
  <div class="overlay" id="overlay">
    <img src="../images/glacier_july_2023.JPG" 
       alt="July 24, 2023 (overlay image)" 
       class="overlay-image">
  </div>
    <div class="slider" id="slider">
        <div class="slider-button"></div>
    </div>
    <div class="labels">
        <div class="label">June 14, 2023</div>
        <div class="label">July 24, 2023</div>
    </div>
</div>

<p class="instructions">
    Drag the slider left and right to compare the images
</p>

<script>
    const slider = document.getElementById('slider');
    const overlay = document.getElementById('overlay');
    const container = document.getElementById('comparison');
    
    let isDragging = false;
    
    function updateSliderPosition(x) {
        const containerRect = container.getBoundingClientRect();
        const containerWidth = containerRect.width;
        const position = Math.max(0, Math.min(x - containerRect.left, containerWidth));
        const percentage = (position / containerWidth) * 100;
        
        overlay.style.width = percentage + '%';
        slider.style.left = percentage + '%';
    }
    
    slider.addEventListener('mousedown', () => {
        isDragging = true;
    });
    
    document.addEventListener('mouseup', () => {
        isDragging = false;
    });
    
    document.addEventListener('mousemove', (e) => {
        if (isDragging) {
            updateSliderPosition(e.clientX);
        }
    });
    
    slider.addEventListener('touchstart', (e) => {
        isDragging = true;
        e.preventDefault();
    });
    
    document.addEventListener('touchend', () => {
        isDragging = false;
    });
    
    document.addEventListener('touchmove', (e) => {
        if (isDragging) {
            updateSliderPosition(e.touches[0].clientX);
        }
    });
    
    container.addEventListener('click', (e) => {
        updateSliderPosition(e.clientX);
    });
</script>
"""

display(HTML(html_code))
```

```{ojs}
//| echo: false
albedoData = [
  {surface: "Fresh Snow", albedo: 0.85, color: "#ffffff"},
  {surface: "Sea Ice", albedo: 0.60, color: "#b3e5fc"},
  {surface: "Old Snow", albedo: 0.45, color: "#e0e0e0"},
  {surface: "Desert Sand", albedo: 0.40, color: "#fdd835"},
  {surface: "Grassland", albedo: 0.25, color: "#81c784"},
  {surface: "Forest", albedo: 0.15, color: "#2e7d32"},
  {surface: "Ocean Water", albedo: 0.06, color: "#1565c0"},
  {surface: "Asphalt", albedo: 0.04, color: "#37474f"}
]

Plot.plot({
  title: "Albedo of Different Surfaces",
  subtitle: "Higher albedo = more reflection = less heating",
  width: 700,
  height: 400,
  x: {label: "Albedo (reflection coefficient)", domain: [0, 1]},
  y: {label: "Surface Type", domain: albedoData.map(d => d.surface)},
  marks: [
    Plot.barX(albedoData, {x: "albedo", y: "surface", fill: "color", sort: {y: "-x"}}),
    Plot.text(albedoData, {x: "albedo", y: "surface", text: d => (d.albedo * 100).toFixed(0) + "%", dx: 25, fontSize: 12})
  ]
})
```

## Interactive: Ice-Albedo Feedback Simulation

```{ojs}
//| echo: false
viewof iceExtent = Inputs.range([0, 100], {
  step: 5,
  value: 50,
  label: "Arctic Ice Coverage (%):"
})
```

```{ojs}
//| echo: false
// Calculate absorbed energy based on ice extent
avgAlbedo = (iceExtent / 100 * 0.6) + ((100 - iceExtent) / 100 * 0.06)
absorbedEnergy = ((1 - avgAlbedo) * 100).toFixed(1)
reflectedEnergy = (avgAlbedo * 100).toFixed(1)

html`
<div style="display: flex; gap: 20px; flex-wrap: wrap; margin: 20px 0;">
  <div style="flex: 1; min-width: 300px;">
    <svg width="350" height="250" style="background: linear-gradient(180deg, #87CEEB 0%, #1565c0 100%); border-radius: 10px;">
      <!-- Ice -->
      <rect x="0" y="150" width="${iceExtent * 3.5}" height="100" fill="#e3f2fd" opacity="0.9"/>
      <!-- Ocean -->
      <rect x="${iceExtent * 3.5}" y="150" width="${(100 - iceExtent) * 3.5}" height="100" fill="#0d47a1"/>
      <!-- Sun rays -->
      <line x1="175" y1="20" x2="100" y2="140" stroke="yellow" stroke-width="3" marker-end="url(#arrow)"/>
      <line x1="175" y1="20" x2="250" y2="140" stroke="yellow" stroke-width="3"/>
      <!-- Reflected rays from ice -->
      <line x1="100" y1="140" x2="50" y2="60" stroke="yellow" stroke-width="2" stroke-dasharray="5,5" opacity="${iceExtent/100}"/>
      <!-- Labels -->
      <text x="50" y="200" fill="white" font-size="12">Ice: ${iceExtent}%</text>
      <text x="250" y="200" fill="white" font-size="12">Ocean: ${100-iceExtent}%</text>
    </svg>
  </div>
  <div style="flex: 1; min-width: 250px; padding: 20px; background: #f5f5f5; border-radius: 10px;">
    <h4 style="margin-top: 0;">Energy Balance</h4>
    <p><strong>Average Albedo:</strong> ${(avgAlbedo * 100).toFixed(1)}%</p>
    <p><strong>Energy Reflected:</strong> ${reflectedEnergy}%</p>
    <p><strong>Energy Absorbed:</strong> ${absorbedEnergy}%</p>
    <div style="margin-top: 15px; padding: 10px; background: ${iceExtent < 30 ? '#ffcdd2' : iceExtent > 70 ? '#c8e6c9' : '#fff9c4'}; border-radius: 5px;">
      <strong>Effect:</strong> ${iceExtent < 30 ? 'üî• High absorption ‚Üí More warming ‚Üí More ice melts' : iceExtent > 70 ? '‚ùÑÔ∏è High reflection ‚Üí Less warming ‚Üí Ice preserved' : '‚öñÔ∏è Moderate balance'}
    </div>
  </div>
</div>
`
```

::: {.lab-activity}
## üî¨ Lab Activity: Albedo Investigation

### Materials:
- Two identical containers with lids
- Black paper and white paper
- Two thermometers
- Heat lamp or sunny window
- Timer

### Procedure:

1. **Setup:**
   - Line one container with black paper (low albedo)
   - Line the other with white paper (high albedo)
   - Place a thermometer in each container

2. **Data Collection:**
   - Record starting temperatures
   - Place both containers under heat lamp or in direct sunlight
   - Record temperatures every 2 minutes for 20 minutes

3. **Data Table:**

| Time (min) | Black Container (¬∞C) | White Container (¬∞C) | Difference (¬∞C) |
|------------|---------------------|---------------------|-----------------|
| 0 | | | |
| 2 | | | |
| 4 | | | |
| 6 | | | |
| 8 | | | |
| 10 | | | |
| 12 | | | |
| 14 | | | |
| 16 | | | |
| 18 | | | |
| 20 | | | |

4. **Analysis Questions:**
   - Which container heated up faster? Why?
   - How does this relate to ice-covered vs. ice-free Arctic?
   - Predict what happens as Arctic ice melts.
:::

``` {python}
#| label: fig-pbs-glacier-comparison
#| fig-cap: "Interactive glacier photo comparison showing dramatic glacial retreat over time. Drag the slider to compare images. (Source: PBS LearningMedia)"
#| echo: false
#| warning: false

from IPython.display import HTML, display

html_code = """
<style>
  .pbs-launch-card {
    max-width: 920px;
    margin: 20px auto;
  }
  .pbs-card {
    display: block;
    border-radius: 14px;
    border: 1px solid rgba(0,0,0,.12);
    background: #fff;
    overflow: hidden;
    text-decoration: none;
    box-shadow: 0 10px 30px rgba(0,0,0,.10);
    transition: transform .15s ease, box-shadow .15s ease;
  }
  .pbs-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 16px 44px rgba(0,0,0,.14);
  }
  .pbs-card svg {
    width: 100%;
    height: auto;
    display: block;
  }
  .pbs-actions {
    display: flex;
    gap: 10px;
    align-items: center;
    justify-content: center;
    margin-top: 12px;
    flex-wrap: wrap;
  }
  .pbs-btn {
    display: inline-block;
    background: #0277bd;
    color: #fff;
    padding: 10px 14px;
    border-radius: 999px;
    font-weight: 700;
    text-decoration: none;
    font-size: 14px;
  }
  .pbs-btn:hover { filter: brightness(0.95); }
  .pbs-note {
    margin-top: 10px;
    font-size: 12px;
    color: #666;
    line-height: 1.4;
    text-align: center;
  }
</style>

<div class="pbs-launch-card">
  <a class="pbs-card" href="https://ny.pbslearningmedia.org/resource/ipy07.sci.ess.earthsys.glacierphoto/documenting-glacial-change/" target="_blank" rel="noopener">
    <svg viewBox="0 0 1200 675" role="img" aria-label="Launch PBS LearningMedia glacier comparison interactive">
      <defs>
        <linearGradient id="pbsbg" x1="0" x2="1" y1="0" y2="1">
          <stop offset="0" stop-color="#0288d1"/>
          <stop offset="1" stop-color="#0d47a1"/>
        </linearGradient>
        <linearGradient id="pbsglow" x1="0" x2="0" y1="0" y2="1">
          <stop offset="0" stop-color="#ffffff" stop-opacity=".95"/>
          <stop offset="1" stop-color="#ffffff" stop-opacity=".75"/>
        </linearGradient>
        <filter id="pbsshadow" x="-20%" y="-20%" width="140%" height="140%">
          <feDropShadow dx="0" dy="12" stdDeviation="18" flood-color="#000" flood-opacity=".28"/>
        </filter>
      </defs>

      <rect width="1200" height="675" fill="url(#pbsbg)"/>
      
      <!-- Mountain/glacier shapes -->
      <path d="M0 300 L200 150 L350 250 L500 120 L700 200 L900 100 L1200 250 L1200 675 L0 675 Z" fill="#e1f5fe" opacity=".85"/>
      <path d="M0 400 L150 280 L400 350 L600 250 L850 320 L1200 280 L1200 675 L0 675 Z" fill="#b3e5fc" opacity=".75"/>

      <!-- Ice/snow highlights -->
      <circle cx="500" cy="120" r="60" fill="#ffffff" opacity=".6"/>
      <circle cx="900" cy="100" r="70" fill="#ffffff" opacity=".5"/>

      <g filter="url(#pbsshadow)">
        <rect x="90" y="180" width="1020" height="340" rx="24" fill="url(#pbsglow)"/>
      </g>

      <text x="140" y="260" font-family="system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif" font-size="44" font-weight="800" fill="#0b1220">
        PBS LearningMedia: Glacier Photos
      </text>
      <text x="140" y="312" font-family="system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif" font-size="26" font-weight="600" fill="#0b1220" opacity=".82">
        Interactive slider comparing glacier retreat over time
      </text>

      <g transform="translate(140 360)">
        <rect x="0" y="0" width="420" height="86" rx="43" fill="#0277bd"/>
        <polygon points="64,22 64,64 102,43" fill="#fff"/>
        <text x="130" y="55" font-family="system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif" font-size="28" font-weight="800" fill="#fff">
          Open Interactive
        </text>
      </g>

      <text x="90" y="610" font-family="system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif" font-size="18" fill="#fff" opacity=".88">
        Click to launch PBS resource (opens in new tab)
      </text>
    </svg>
  </a>

  <div class="pbs-actions">
    <a class="pbs-btn" href="https://ny.pbslearningmedia.org/resource/ipy07.sci.ess.earthsys.glacierphoto/documenting-glacial-change/" target="_blank" rel="noopener">Launch PBS Glacier Interactive</a>
  </div>

  <p class="pbs-note">
    PBS LearningMedia resources work best when opened in a new browser tab. If blocked, check your school network settings.
  </p>
</div>
"""

display(HTML(html_code))
```

# Explain Part 1: CO‚ÇÇ‚ÄìTemperature Connection

How are atmospheric carbon dioxide levels and temperatures related? Construct an explanation using evidence from the simulation, ice core data, and text, describing how human activities have increased greenhouse gas levels and how that drives warming.

# Explain Part 2: Feedback Loops in the Climate System

::: {.explain-box}
## üîÑ Understanding Climate Feedbacks

A **feedback loop** occurs when the output of a system affects its input, creating a cycle.

### Positive Feedback (Amplifying)
Makes changes BIGGER - the system amplifies itself

### Negative Feedback (Stabilizing)  
Makes changes SMALLER - the system stabilizes itself
:::

## Interactive Feedback Loop Diagram

```{ojs}
//| echo: false
viewof feedbackTypeSimple = Inputs.radio(["Ice-Albedo Feedback", "Water Vapor Feedback", "Permafrost Feedback"], {
  label: "Select feedback loop:",
  value: "Ice-Albedo Feedback"
})
```

```{ojs}
//| echo: false
feedbackInfo = {
  if (feedbackTypeSimple === "Ice-Albedo Feedback") {
    return {
      steps: [
        "1. Temperature increases",
        "2. Ice and snow melt",
        "3. Darker ocean/land exposed",
        "4. More solar radiation absorbed",
        "5. Temperature increases MORE"
      ],
      color: "#3498db",
      icon: "üßä"
    }
  } else if (feedbackTypeSimple === "Water Vapor Feedback") {
    return {
      steps: [
        "1. Temperature increases",
        "2. More water evaporates",
        "3. Water vapor is a greenhouse gas",
        "4. More heat trapped in atmosphere",
        "5. Temperature increases MORE"
      ],
      color: "#9b59b6",
      icon: "üí®"
    }
  } else {
    return {
      steps: [
        "1. Temperature increases",
        "2. Permafrost thaws",
        "3. Trapped methane/CO‚ÇÇ released",
        "4. More greenhouse gases in atmosphere",
        "5. Temperature increases MORE"
      ],
      color: "#e67e22",
      icon: "üèîÔ∏è"
    }
  }
}

html`
<div style="background: linear-gradient(135deg, ${feedbackInfo.color}22, ${feedbackInfo.color}44); padding: 25px; border-radius: 15px; border-left: 5px solid ${feedbackInfo.color};">
  <h3 style="margin-top: 0;">${feedbackInfo.icon} ${feedbackType}</h3>
  <div style="display: flex; flex-direction: column; gap: 10px;">
    ${feedbackInfo.steps.map((step, i) => `
      <div style="display: flex; align-items: center; gap: 10px;">
        <div style="width: 30px; height: 30px; background: ${feedbackInfo.color}; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">${i+1}</div>
        <div style="flex: 1; padding: 10px; background: white; border-radius: 5px;">${step.substring(3)}</div>
        ${i < feedbackInfo.steps.length - 1 ? '<div style="font-size: 20px;">‚Üì</div>' : '<div style="font-size: 20px;">üîÑ</div>'}
      </div>
    `).join('')}
  </div>
  <p style="margin-top: 15px; font-style: italic;"><strong>Type:</strong> Positive (amplifying) feedback - makes warming worse!</p>
</div>
`
```

::: {.feedback-loop}
## üåç Why the Arctic Warms ~4x Faster

The **Ice-Albedo Feedback** explains Arctic amplification:

1. **Arctic starts bright**: thick ice/snow with high albedo (~60%)
2. **Warming melts ice**: exposes darker ocean/land (albedo ~6%)
3. **Energy jump**: darker surfaces absorb ~10x more solar energy
4. **Faster local warming**: extra absorbed heat accelerates melt
5. **Runaway loop**: more melt ‚Üí lower albedo ‚Üí more absorption

This positive feedback is why the Arctic is the "canary in the coal mine." It also explains why Arctic warming is much higher than the global average.
:::

## Arctic Sea Ice Decline

```{ojs}
//| echo: false
seaIceData = [
  {year: 1980, extent: 7.8},
  {year: 1985, extent: 7.5},
  {year: 1990, extent: 7.4},
  {year: 1995, extent: 7.1},
  {year: 2000, extent: 6.8},
  {year: 2005, extent: 6.2},
  {year: 2007, extent: 4.3},
  {year: 2010, extent: 5.0},
  {year: 2012, extent: 3.6},
  {year: 2015, extent: 4.6},
  {year: 2020, extent: 3.9},
  {year: 2024, extent: 4.2}
]

Plot.plot({
  title: "September Arctic Sea Ice Extent",
  subtitle: "Million square kilometers",
  width: 700,
  height: 400,
  x: {label: "Year"},
  y: {label: "Sea Ice Extent (million km¬≤)", domain: [0, 9]},
  marks: [
    Plot.areaY(seaIceData, {x: "year", y: "extent", fill: "#81d4fa", fillOpacity: 0.5}),
    Plot.line(seaIceData, {x: "year", y: "extent", stroke: "#0277bd", strokeWidth: 3}),
    Plot.dot(seaIceData, {x: "year", y: "extent", fill: "#01579b", r: 5}),
    Plot.dot(seaIceData.filter(d => d.year === 2012), {x: "year", y: "extent", fill: "#e74c3c", r: 8}),
    Plot.text(seaIceData.filter(d => d.year === 2012), {x: "year", y: "extent", text: d => "Record Low: 2012", dy: -15, fill: "#e74c3c", fontSize: 11}),
    Plot.linearRegressionY(seaIceData, {x: "year", y: "extent", stroke: "#e74c3c", strokeDasharray: "5,5"})
  ]
})
```

::: {.check-understanding}
### ‚úÖ Check Your Understanding

1. What type of feedback is the ice-albedo feedback? (positive or negative)
2. Why does exposing dark ocean water lead to more warming?
3. Calculate: If ice (albedo 0.6) is replaced by ocean (albedo 0.06), how much more energy is absorbed?
4. How does the ice-albedo feedback help explain why the Arctic warms faster than the rest of the planet?
:::

# Elaborate: Greenhouse Gases + Albedo Together

How do greenhouse gases and albedo interact? Model the combined effects of greenhouse gas and albedo feedback loops to explain the rapid rate of change of Earth‚Äôs temperature and make claims about what could happen in the future based on historical and current evidence.

## CO‚ÇÇ and Human Activity

## Where Does the CO‚ÇÇ Come From?

```{ojs}
//| echo: false
co2SourcesData = [
  {source: "Electricity & Heat", emissions: 25, color: "#e74c3c"},
  {source: "Transportation", emissions: 16, color: "#3498db"},
  {source: "Manufacturing", emissions: 21, color: "#f39c12"},
  {source: "Agriculture & Land Use", emissions: 24, color: "#27ae60"},
  {source: "Buildings", emissions: 6, color: "#9b59b6"},
  {source: "Other Energy", emissions: 8, color: "#95a5a6"}
]

Plot.plot({
  title: "Global Greenhouse Gas Emissions by Sector",
  width: 600,
  height: 400,
  x: {label: "Percentage of Global Emissions"},
  y: {label: "Sector", domain: co2SourcesData.map(d => d.source)},
  marks: [
    Plot.barX(co2SourcesData, {x: "emissions", y: "source", fill: "color", sort: {y: "-x"}}),
    Plot.text(co2SourcesData, {x: "emissions", y: "source", text: d => d.emissions + "%", dx: 20, fontSize: 12, fontWeight: "bold"})
  ]
})
```

## CO‚ÇÇ Growth Over Time

```{ojs}
//| echo: false
co2GrowthData = [
  {year: 1750, co2: 280, source: "Pre-industrial"},
  {year: 1800, co2: 283, source: "Historical"},
  {year: 1850, co2: 288, source: "Historical"},
  {year: 1900, co2: 296, source: "Historical"},
  {year: 1950, co2: 311, source: "Historical"},
  {year: 1960, co2: 317, source: "Mauna Loa"},
  {year: 1970, co2: 326, source: "Mauna Loa"},
  {year: 1980, co2: 339, source: "Mauna Loa"},
  {year: 1990, co2: 354, source: "Mauna Loa"},
  {year: 2000, co2: 369, source: "Mauna Loa"},
  {year: 2010, co2: 390, source: "Mauna Loa"},
  {year: 2020, co2: 414, source: "Mauna Loa"},
  {year: 2024, co2: 422, source: "Mauna Loa"}
]

Plot.plot({
  title: "Atmospheric CO‚ÇÇ Concentration (1750-2024)",
  subtitle: "Parts per million (ppm)",
  width: 700,
  height: 400,
  x: {label: "Year"},
  y: {label: "CO‚ÇÇ (ppm)", domain: [270, 440]},
  marks: [
    Plot.ruleY([280], {stroke: "#27ae60", strokeDasharray: "5,5"}),
    Plot.text([{x: 1800, y: 275}], {x: "x", y: "y", text: d => "Pre-industrial level: 280 ppm", fill: "#27ae60", fontSize: 10}),
    Plot.ruleY([350], {stroke: "#f39c12", strokeDasharray: "5,5"}),
    Plot.text([{x: 1800, y: 345}], {x: "x", y: "y", text: d => "\"Safe\" level: 350 ppm", fill: "#f39c12", fontSize: 10}),
    Plot.line(co2GrowthData, {x: "year", y: "co2", stroke: "#e74c3c", strokeWidth: 3}),
    Plot.dot(co2GrowthData, {x: "year", y: "co2", fill: "#c0392b", r: 4})
  ]
})
```

::: {.key-idea}
### üí° Key Ideas: Climate Feedbacks

1. **The greenhouse effect** explains why increasing CO‚ÇÇ leads to global warming
2. **Albedo** is the tendency of a surface to reflect or absorb radiation
3. **Ice has high albedo** (~60%) compared to seawater (~6%)
4. **As ice melts, more radiation is absorbed**, causing more warming ‚Üí positive feedback
5. **Arctic amplification** (4x faster warming) is explained by ice-albedo feedback
6. **Multiple feedback loops** (ice-albedo, water vapor, permafrost) amplify climate change
7. **Human activities** have dramatically increased CO‚ÇÇ levels beyond natural ranges
:::

# Evaluate: Modeling Climate Feedbacks

::: {.evaluate-box}
## üìä Performance Task Check-In

Using what you've learned, you can now explain:

1. **Why scientists are confident humans are causing climate change:**
   - CO‚ÇÇ levels are far beyond natural range (420 ppm vs. max 280 ppm)
   - The timing matches industrialization
   - Natural factors (Milankovitch cycles, solar output) can't explain current warming

2. **Why the Arctic is warming so fast:**
   - Ice-albedo feedback amplifies warming
   - As ice melts, dark ocean absorbs more energy
   - This creates a self-reinforcing cycle

3. **How feedbacks make climate change worse:**
   - Ice-albedo: melting ice ‚Üí more absorption ‚Üí more melting
   - Water vapor: warming ‚Üí more evaporation ‚Üí more greenhouse effect
   - Permafrost: warming ‚Üí methane release ‚Üí more warming
   
4. **Claim with evidence:** Use data from this lesson to explain how human activities are driving destabilizing feedback loops today.
:::

## Create Your Feedback Diagram

::: {.lab-activity}
### üìù Activity: Draw Your Own Feedback Loop

Create a diagram showing how multiple feedback loops interact:

1. Start with "Human emissions increase CO‚ÇÇ"
2. Show how this leads to warming
3. Include ice-albedo feedback
4. Include water vapor feedback
5. Show how they connect and amplify each other
6. Indicate which parts are observed data vs. projected consequences

**Guiding Questions:**
- Where do humans enter this system?
- Which parts of the cycle have we already observed?
- What might happen if Arctic ice disappears entirely in summer?
- Are there any potential negative (stabilizing) feedbacks?
:::

# Interactive Carbon Cycle Flow Diagram

This visualization shows how carbon flows between Earth's major reservoirs changed after the Industrial Revolution.

```{ojs}
//| echo: false

// Data for carbon reservoirs and flows
carbonData = {
  const preIndustrial = {
    atmosphere: 560,
    ocean: 38000,
    landBiomass: 2160,
    fossilFuels: 10000,
    flows: [
      {from: "ocean", to: "atmosphere", value: 90},
      {from: "atmosphere", to: "ocean", value: 92},
      {from: "landBiomass", to: "atmosphere", value: 60},
      {from: "atmosphere", to: "landBiomass", value: 62},
      {from: "fossilFuels", to: "atmosphere", value: 0}
    ]
  };
  
  const postIndustrial = {
    atmosphere: 840,
    ocean: 41000,
    landBiomass: 2500,
    fossilFuels: 9000,
    flows: [
      {from: "ocean", to: "atmosphere", value: 90},
      {from: "atmosphere", to: "ocean", value: 93},
      {from: "landBiomass", to: "atmosphere", value: 60},
      {from: "atmosphere", to: "landBiomass", value: 63},
      {from: "fossilFuels", to: "atmosphere", value: 9.4}
    ]
  };
  
  return {preIndustrial, postIndustrial};
}

// Time period selector
viewof timePeriod = Inputs.radio(
  ["Pre-Industrial Revolution (1750)", "Post-Industrial Revolution (2020)"],
  {value: "Pre-Industrial Revolution (1750)", label: "Time Period"}
)

// Get current data based on selection
currentData = timePeriod.includes("Pre-Industrial") 
  ? carbonData.preIndustrial 
  : carbonData.postIndustrial

// Calculate changes
atmosphereChange = carbonData.postIndustrial.atmosphere - carbonData.preIndustrial.atmosphere
fossilFuelBurned = carbonData.preIndustrial.fossilFuels - carbonData.postIndustrial.fossilFuels

// Visualization
{
  const width = 800;
  const height = 600;
  const margin = {top: 20, right: 20, bottom: 60, left: 20};
  
  const svg = d3.create("svg")
    .attr("viewBox", [0, 0, width, height])
    .attr("style", "max-width: 100%; height: auto;");
  
  // Define positions for reservoirs
  const positions = {
    atmosphere: {x: width/2, y: 100, color: "#93c5fd"},
    ocean: {x: 150, y: 400, color: "#0ea5e9"},
    landBiomass: {x: 650, y: 400, color: "#22c55e"},
    fossilFuels: {x: width/2, y: 500, color: "#64748b"}
  };
  
  // Draw flows (arrows)
  const arrowGroup = svg.append("g");
  
  currentData.flows.forEach(flow => {
    if (flow.value > 0) {
      const start = positions[flow.from];
      const end = positions[flow.to];
      
      // Calculate arrow path with curve
      const midX = (start.x + end.x) / 2;
      const midY = (start.y + end.y) / 2;
      const dx = end.x - start.x;
      const dy = end.y - start.y;
      const dr = Math.sqrt(dx * dx + dy * dy) * 0.7;
      
      arrowGroup.append("path")
        .attr("d", `M${start.x},${start.y} Q${midX + dy/4},${midY - dx/4} ${end.x},${end.y}`)
        .attr("fill", "none")
        .attr("stroke", flow.from === "fossilFuels" ? "#ef4444" : "#94a3b8")
        .attr("stroke-width", Math.max(2, flow.value / 10))
        .attr("opacity", 0.6)
        .attr("marker-end", "url(#arrowhead)");
      
      // Add flow label
      arrowGroup.append("text")
        .attr("x", midX + dy/4)
        .attr("y", midY - dx/4)
        .attr("text-anchor", "middle")
        .attr("font-size", "12px")
        .attr("fill", "#1e293b")
        .attr("font-weight", "600")
        .text(`${flow.value} Gt/yr`);
    }
  });
  
  // Define arrowhead marker
  svg.append("defs")
    .append("marker")
    .attr("id", "arrowhead")
    .attr("markerWidth", 10)
    .attr("markerHeight", 10)
    .attr("refX", 9)
    .attr("refY", 3)
    .attr("orient", "auto")
    .append("polygon")
    .attr("points", "0 0, 10 3, 0 6")
    .attr("fill", "#94a3b8");
  
  // Draw reservoirs
  Object.entries(positions).forEach(([name, pos]) => {
    const reservoir = currentData[name];
    const radius = Math.sqrt(reservoir) / 3;
    
    const group = svg.append("g")
      .attr("transform", `translate(${pos.x}, ${pos.y})`);
    
    // Circle
    group.append("circle")
      .attr("r", radius)
      .attr("fill", pos.color)
      .attr("stroke", "#1e293b")
      .attr("stroke-width", 2)
      .attr("opacity", 0.8);
    
    // Label
    group.append("text")
      .attr("text-anchor", "middle")
      .attr("dy", -radius - 10)
      .attr("font-size", "14px")
      .attr("font-weight", "700")
      .attr("fill", "#1e293b")
      .text(name.replace(/([A-Z])/g, ' $1').trim());
    
    // Value
    group.append("text")
      .attr("text-anchor", "middle")
      .attr("dy", "0.35em")
      .attr("font-size", "16px")
      .attr("font-weight", "600")
      .attr("fill", "#ffffff")
      .text(`${reservoir} Gt`);
  });
  
  // Add title
  svg.append("text")
    .attr("x", width/2)
    .attr("y", 30)
    .attr("text-anchor", "middle")
    .attr("font-size", "18px")
    .attr("font-weight", "700")
    .attr("fill", "#1e293b")
    .text(`Carbon Reservoirs: ${timePeriod}`);
  
  return svg.node();
}

// Key findings display
md`
### Key Changes After Industrial Revolution:

- **Atmospheric CO‚ÇÇ increased by ${atmosphereChange} Gt** (${((atmosphereChange/carbonData.preIndustrial.atmosphere)*100).toFixed(1)}% increase)
- **${fossilFuelBurned} Gt of fossil fuels burned** and added to atmosphere
- **Ocean absorbed ${carbonData.postIndustrial.ocean - carbonData.preIndustrial.ocean} Gt** more carbon
- **The carbon cycle became unbalanced** - more carbon entering atmosphere than leaving
`
```

# Feedback Loop Visualization

This visualization shows how positive feedback mechanisms amplify climate change through interconnected processes.

```{ojs}
//| echo: false

// Import d3 library
d3 = require("d3@7")

// Feedback type selector
viewof feedbackType = Inputs.radio(
  ["Ice-Albedo Feedback", "Greenhouse Gas Feedback", "Combined Feedbacks"],
  {value: "Ice-Albedo Feedback", label: "Select Feedback Mechanism"}
)

// Animation control
viewof isAnimating = Inputs.toggle({label: "Animate feedback loop", value: true})
```

```{ojs}
//| echo: false

// Define feedback loops
feedbackLoops = {
  const iceAlbedo = [
    {step: 0, label: "CO‚ÇÇ Emissions\nIncrease", x: 400, y: 50, color: "#ef4444"},
    {step: 1, label: "Global Temperature\nRises", x: 650, y: 150, color: "#f97316"},
    {step: 2, label: "Arctic Ice\nMelts", x: 650, y: 350, color: "#06b6d4"},
    {step: 3, label: "Less Solar\nReflection", x: 400, y: 450, color: "#3b82f6"},
    {step: 4, label: "More Heat\nAbsorbed", x: 150, y: 350, color: "#8b5cf6"},
    {step: 5, label: "Temperature\nRises Further", x: 150, y: 150, color: "#dc2626"}
  ];
  
  const greenhouseGas = [
    {step: 0, label: "Temperature\nIncreases", x: 400, y: 50, color: "#f97316"},
    {step: 1, label: "Ocean Water\nWarms", x: 650, y: 150, color: "#0ea5e9"},
    {step: 2, label: "CO‚ÇÇ Released\nfrom Ocean", x: 650, y: 350, color: "#64748b"},
    {step: 3, label: "Permafrost\nThaws", x: 400, y: 450, color: "#a855f7"},
    {step: 4, label: "More GHGs\nEnter Atmosphere", x: 150, y: 350, color: "#ef4444"},
    {step: 5, label: "Greenhouse Effect\nStrengthens", x: 150, y: 150, color: "#dc2626"}
  ];
  
  const combined = [
    {step: 0, label: "Human Activity:\nFossil Fuel Burning", x: 400, y: 30, color: "#1e293b"},
    {step: 1, label: "CO‚ÇÇ & GHGs\nIncrease", x: 600, y: 120, color: "#64748b"},
    {step: 2, label: "Enhanced\nGreenhouse Effect", x: 700, y: 250, color: "#ef4444"},
    {step: 3, label: "Temperature\nRises", x: 650, y: 380, color: "#f97316"},
    {step: 4, label: "Ice Melts\nAlbedo ‚Üì", x: 480, y: 480, color: "#06b6d4"},
    {step: 5, label: "Ocean/Permafrost\nRelease CO‚ÇÇ", x: 280, y: 480, color: "#3b82f6"},
    {step: 6, label: "More Heat\nAbsorbed", x: 120, y: 380, color: "#8b5cf6"},
    {step: 7, label: "AMPLIFICATION:\nFaster Warming", x: 100, y: 250, color: "#dc2626"},
    {step: 8, label: "Multiple Feedbacks\nReinforce", x: 200, y: 120, color: "#991b1b"}
  ];
  
  return {iceAlbedo, greenhouseGas, combined};
}
```

```{ojs}
//| echo: false

// Get current loop
currentLoop = feedbackType === "Ice-Albedo Feedback" 
  ? feedbackLoops.iceAlbedo 
  : feedbackType === "Greenhouse Gas Feedback"
  ? feedbackLoops.greenhouseGas
  : feedbackLoops.combined
```

```{ojs}
//| echo: false

// Animation frame
mutable currentStep = 0

tick = {
  if (isAnimating) {
    while (true) {
      yield Promises.tick(1500);
      mutable currentStep = (currentStep + 1) % currentLoop.length;
    }
  }
}
```

```{ojs}
//| echo: false

// Visualization
chart = {
  const width = 800;
  const height = 550;
  
  const svg = d3.create("svg")
    .attr("viewBox", [0, 0, width, height])
    .attr("style", "max-width: 100%; height: auto;");
  
  // Define arrow markers first
  const defs = svg.append("defs");
  
  ["active", "inactive"].forEach(state => {
    defs.append("marker")
      .attr("id", `arrow-${state}`)
      .attr("markerWidth", 12)
      .attr("markerHeight", 12)
      .attr("refX", 11)
      .attr("refY", 3)
      .attr("orient", "auto")
      .append("polygon")
      .attr("points", "0 0, 12 3, 0 6")
      .attr("fill", state === "active" ? "#dc2626" : "#cbd5e1");
  });
  
  // Draw connecting paths
  const pathGroup = svg.append("g");
  
  for (let i = 0; i < currentLoop.length; i++) {
    const current = currentLoop[i];
    const next = currentLoop[(i + 1) % currentLoop.length];
    
    const isActive = isAnimating ? (i === currentStep) : true;
    const strokeWidth = isActive ? 6 : 3;
    const opacity = isActive ? 1 : 0.3;
    
    // Create curved path
    const midX = (current.x + next.x) / 2;
    const midY = (current.y + next.y) / 2;
    const dx = next.x - current.x;
    const dy = next.y - current.y;
    
    pathGroup.append("path")
      .attr("d", `M${current.x},${current.y} Q${midX + dy/3},${midY - dx/3} ${next.x},${next.y}`)
      .attr("fill", "none")
      .attr("stroke", isActive ? current.color : "#cbd5e1")
      .attr("stroke-width", strokeWidth)
      .attr("opacity", opacity)
      .attr("marker-end", isActive ? "url(#arrow-active)" : "url(#arrow-inactive)")
      .attr("stroke-dasharray", isActive ? "8,4" : "none");
  }
  
  // Draw nodes
  currentLoop.forEach((node, i) => {
    const isActive = isAnimating ? (i === currentStep) : true;
    const nodeRadius = 50;
    
    const group = svg.append("g")
      .attr("transform", `translate(${node.x}, ${node.y})`);
    
    // Node circle
    group.append("circle")
      .attr("r", nodeRadius)
      .attr("fill", isActive ? node.color : "#e2e8f0")
      .attr("stroke", isActive ? "#1e293b" : "#94a3b8")
      .attr("stroke-width", isActive ? 3 : 2)
      .attr("opacity", isActive ? 0.95 : 0.5);
    
    // Node label
    const lines = node.label.split("\\n");
    lines.forEach((line, idx) => {
      group.append("text")
        .attr("text-anchor", "middle")
        .attr("dy", `${-0.3 + idx * 1.2}em`)
        .attr("font-size", "13px")
        .attr("font-weight", isActive ? "700" : "500")
        .attr("fill", isActive ? "#ffffff" : "#64748b")
        .text(line);
    });
    
    // Step number
    group.append("circle")
      .attr("cx", nodeRadius - 15)
      .attr("cy", -nodeRadius + 15)
      .attr("r", 15)
      .attr("fill", "#1e293b")
      .attr("opacity", 0.9);
    
    group.append("text")
      .attr("x", nodeRadius - 15)
      .attr("y", -nodeRadius + 15)
      .attr("text-anchor", "middle")
      .attr("dy", "0.35em")
      .attr("font-size", "12px")
      .attr("font-weight", "700")
      .attr("fill", "#ffffff")
      .text(i + 1);
  });
  
  // Add title
  svg.append("text")
    .attr("x", width/2)
    .attr("y", height - 20)
    .attr("text-anchor", "middle")
    .attr("font-size", "16px")
    .attr("font-weight", "700")
    .attr("fill", "#1e293b")
    .text(`${feedbackType}: A Positive (Amplifying) Feedback Loop`);
  
  return svg.node();
}
```

```{ojs}
//| echo: false

// Explanatory text
md`
### Understanding Positive Feedbacks

${feedbackType === "Ice-Albedo Feedback" ? `
**Ice-Albedo Feedback** occurs when warming melts reflective ice and snow, exposing darker surfaces (ocean, land) that absorb more solar radiation. This extra absorption causes more warming, which melts more ice - a self-reinforcing cycle that **amplifies** the initial warming.

**Key Point:** Arctic regions are warming **~4 times faster** than the global average due to this feedback!
` : feedbackType === "Greenhouse Gas Feedback" ? `
**Greenhouse Gas Feedback** happens when warming temperatures cause natural systems to release stored carbon. Warmer oceans hold less dissolved CO‚ÇÇ, and thawing permafrost releases both CO‚ÇÇ and methane. These additional greenhouse gases trap more heat, causing further warming and more release.

**Key Point:** This creates a situation where human-caused warming **triggers natural carbon releases** that we don't directly control.
` : `
**Combined Feedbacks** show how multiple reinforcing mechanisms work together to amplify warming far beyond the initial forcing from fossil fuel emissions. Each feedback strengthens the others:

- More GHGs ‚Üí More warming ‚Üí Ice melts ‚Üí Less reflection ‚Üí Even more warming
- More warming ‚Üí Ocean/permafrost release CO‚ÇÇ ‚Üí More GHGs ‚Üí Even more warming

**Key Point:** The **rate of current warming** (0.2¬∞C per decade) is unprecedented in the last 2,000 years because these feedbacks amplify the human-caused forcing.
`}

‚ö†Ô∏è **Why this matters:** These are called **positive feedbacks** not because they're good, but because they **amplify change** rather than damping it. Once triggered, they make climate change harder to stop.
`
```


---

::: {.quiz-section}
## üìù Climate Feedbacks Quiz (Click to Reveal Answers)

**Question 1:** What is the primary greenhouse gas that humans have increased in the atmosphere?
- A) Oxygen
- B) Nitrogen
- C) Carbon dioxide
- D) Argon
<details>
<summary>Show answer</summary>
<p><strong>Answer:</strong> C) Carbon dioxide</p>
</details>

**Question 2:** What is albedo?
- A) The amount of CO‚ÇÇ in the atmosphere
- B) The measure of how much light a surface reflects
- C) The temperature of the ocean
- D) The speed of ice melting
<details>
<summary>Show answer</summary>
<p><strong>Answer:</strong> B) The measure of how much light a surface reflects</p>
</details>

**Question 3:** Which surface has the HIGHEST albedo?
- A) Fresh snow
- B) Ocean water
- C) Forest
- D) Desert sand
<details>
<summary>Show answer</summary>
<p><strong>Answer:</strong> A) Fresh snow</p>
</details>

**Question 4:** The ice-albedo feedback is an example of:
- A) Negative feedback that stabilizes climate
- B) Positive feedback that amplifies warming
- C) No feedback effect
- D) A cooling mechanism
<details>
<summary>Show answer</summary>
<p><strong>Answer:</strong> B) Positive feedback that amplifies warming</p>
</details>

**Question 5:** Why is the Arctic warming almost 4 times faster than the global average?
- A) The Sun is closer to the Arctic
- B) Ice-albedo feedback amplifies warming there
- C) There are more people in the Arctic
- D) Volcanic activity in the Arctic
<details>
<summary>Show answer</summary>
<p><strong>Answer:</strong> B) Ice-albedo feedback amplifies warming there</p>
</details>

**Question 6:** Current atmospheric CO‚ÇÇ levels are approximately:
- A) 280 ppm (pre-industrial level)
- B) 350 ppm
- C) 420 ppm
- D) 1000 ppm
<details>
<summary>Show answer</summary>
<p><strong>Answer:</strong> C) 420 ppm</p>
</details>

**Question 7:** In the greenhouse effect, what type of radiation do greenhouse gases absorb?
- A) Visible light from the Sun
- B) Ultraviolet radiation
- C) Infrared radiation from Earth's surface
- D) X-rays
<details>
<summary>Show answer</summary>
<p><strong>Answer:</strong> C) Infrared radiation from Earth's surface</p>
</details>

**Question 8:** The permafrost feedback involves the release of which gases?
- A) Oxygen and nitrogen
- B) Methane and carbon dioxide
- C) Ozone and CFCs
- D) Hydrogen and helium
<details>
<summary>Show answer</summary>
<p><strong>Answer:</strong> B) Methane and carbon dioxide</p>
</details>

**Question 9:** If Arctic sea ice (albedo 0.60) is replaced by open ocean (albedo 0.06), what happens to energy absorption?
- A) Stays the same
- B) Decreases slightly
- C) Increases dramatically (10x more absorbed)
- D) Decreases dramatically
<details>
<summary>Show answer</summary>
<p><strong>Answer:</strong> C) Increases dramatically (10x more absorbed)</p>
</details>

**Question 10:** Which statement best explains why scientists are confident humans are causing current climate change?
- A) It's just a guess
- B) Temperatures have changed before naturally
- C) CO‚ÇÇ levels are far beyond natural range and match timing of industrialization
- D) The Sun has gotten brighter
<details>
<summary>Show answer</summary>
<p><strong>Answer:</strong> C) CO‚ÇÇ levels are far beyond natural range and match timing of industrialization</p>
</details>
:::